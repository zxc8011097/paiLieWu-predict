<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé¢„æµ‹ç³»ç»Ÿ Â· æ’åˆ—ä¸‰/äº” ç»ˆæå®Œæ•´ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* å®Œæ•´æ ·å¼ï¼ˆå‹ç¼©ç‰ˆï¼‰ */
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;user-select:none;}
        :root{--bg:#0c0c0c;--card:#1a1a1a;--gold:#c9a868;--blue:#00aaff;--light-bg:#222;--text:#f0f0f0;--tip:#888;--radius:16px;--shadow:0 8px 24px rgba(0,0,0,0.3);--transition:all 0.3s ease;}
        body{background:var(--bg);color:var(--text);transition:var(--transition);padding-bottom:40px;overflow-x:hidden;}
        body.dark-mode{--bg:#000;--card:#111;--light-bg:#1a1a1a;}
        .container{max-width:1000px;margin:0 auto;padding:20px;}
        .top-nav{background:var(--card);border-radius:var(--radius);padding:12px;margin-bottom:16px;display:flex;gap:8px;overflow-x:auto;white-space:nowrap;box-shadow:var(--shadow);}
        .nav-item{flex:1;min-width:70px;padding:10px 8px;border-radius:10px;text-align:center;font-size:14px;font-weight:500;cursor:pointer;background:var(--light-bg);color:#ccc;transition:var(--transition);}
        .nav-item.active{background:var(--gold);color:#000;font-weight:bold;}
        .navbar{background:var(--card);border-radius:var(--radius);padding:16px 20px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow);z-index:10;}
        .navbar h1{font-size:20px;color:var(--gold);font-weight:700;}
        .nav-buttons{display:flex;gap:8px;align-items:center;}
        .btn{padding:8px 14px;border-radius:10px;font-size:14px;font-weight:500;border:none;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;justify-content:center;}
        .btn-primary{background:var(--gold);color:#000;}
        .btn-outline{background:transparent;border:1px solid var(--gold);color:var(--gold);}
        .card{background:var(--card);border-radius:var(--radius);padding:24px;margin-bottom:16px;box-shadow:var(--shadow);transition:var(--transition);display:none;}
        .card.show{display:block;}
        .card-title{font-size:16px;font-weight:600;color:var(--gold);margin-bottom:16px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
        input,select,textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #333;background:#222;color:var(--text);margin-bottom:12px;font-size:15px;user-select:auto;}
        input:focus{outline:none;border-color:var(--gold);}
        .countdown{font-size:18px;font-weight:700;color:var(--blue);text-align:center;padding:12px;background:var(--light-bg);border-radius:12px;}
        .stats{display:flex;flex-wrap:wrap;gap:8px;}
        .stats span{padding:6px 10px;background:var(--light-bg);color:var(--gold);border-radius:8px;font-size:13px;}
        .balls{display:flex;gap:12px;justify-content:center;margin:16px 0;flex-wrap:wrap;}
        .ball{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#c9a868,#a08040);color:#000;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;}
        .num-ball{width:28px;height:28px;border-radius:50%;background:var(--blue);color:#fff;display:inline-flex;align-items:center;justify-content:center;font-size:12px;}
        .grid5{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;}
        .item{background:var(--light-bg);border-radius:12px;padding:16px 10px;text-align:center;font-size:14px;color:var(--gold);}
        .item strong{font-size:16px;}
        .history-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px dashed #333;font-size:15px;flex-wrap:wrap;}
        .p3-box{display:flex;justify-content:center;gap:10px;margin:16px 0;flex-wrap:wrap;}
        .p3-ball{width:46px;height:46px;border-radius:50%;background:var(--blue);color:#fff;display:flex;align-items:center;justify-content:center;font-size:17px;font-weight:700;}
        .p3-list{max-height:380px;overflow-y:auto;margin-top:12px;}
        .p3-item{padding:10px 14px;background:var(--light-bg);border-radius:10px;margin-bottom:8px;font-size:15px;display:flex;justify-content:space-between;}
        .tip{font-size:12px;color:var(--tip);text-align:center;margin-top:8px;}
        .rate{color:var(--blue);font-weight:600;font-size:15px;text-align:center;margin-top:8px;}
        .loading{text-align:center;padding:10px;color:var(--gold);font-size:14px;display:none;}
        .login-lock,.ad-lock{position:fixed;top:0;left:0;width:100%;height:100%;background:#0c0c0c;display:flex;align-items:center;justify-content:center;z-index:9999;}
        .login-box,.ad-box{width:90%;max-width:400px;background:var(--card);border-radius:20px;padding:40px 30px;box-shadow:0 12px 32px rgba(0,0,0,0.4);text-align:center;}
        .login-box h2,.ad-box h2{margin-bottom:24px;color:var(--gold);}
        .vip-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:9998;}
        .vip-box{width:90%;max-width:400px;background:var(--card);border-radius:20px;padding:30px;text-align:center;}
        .vip-title{font-size:22px;color:var(--gold);margin-bottom:10px;font-weight:bold;}
        .summary-card{background:var(--card);border-left:4px solid var(--gold);}
        .admin-box{display:none;}
        #adminPanel{display:none;margin-top:16px;}
        .copyright{text-align:center;font-size:12px;color:#666;margin-top:30px;line-height:1.5;}
        .canvas-container{width:100%;height:200px;margin:10px 0;background:#111;border-radius:8px;padding:5px;}
        .heatmap-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:2px;margin:10px 0;}
        .heat-cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:12px;border-radius:4px;background:#2a2a2a;color:#ccc;flex-direction:column;}
        .heat-cell.hot{background:#c9a868;color:#000;}
        .heat-cell.cold{background:#3a3a3a;color:#aaa;}
        .slider-group{display:flex;align-items:center;gap:10px;margin:8px 0;}
        .slider-group label{width:100px;font-size:14px;}
        .slider-group input{flex:1;margin:0;}
        .slider-group span{width:40px;text-align:right;}
        .explain-box{background:#2a2a2a;border-radius:8px;padding:10px;margin:10px 0;font-size:13px;line-height:1.6;}
        .share-btn{background:#00aaff;color:#fff;border:none;}
        .feature-badge{display:inline-block;background:var(--blue);color:#000;padding:2px 8px;border-radius:12px;font-size:10px;margin-left:8px;}
        .real-data-badge{display:inline-block;background:#ff4d4f;color:#fff;padding:2px 8px;border-radius:12px;font-size:10px;margin-left:8px;}
        .source-tag{color:var(--gold);font-size:10px;padding:2px 6px;background:#2a2a2a;border-radius:12px;display:inline-block;margin-left:5px;}
        .stat-row{display:flex;justify-content:space-between;background:#2a2a2a;padding:8px 12px;border-radius:8px;margin:5px 0;font-size:13px;}
        .algo-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:10px 0;}
        .algo-card{background:var(--light-bg);border-radius:12px;padding:12px;text-align:center;cursor:pointer;transition:var(--transition);}
        .algo-card:hover{background:#333;}
        .algo-title{font-size:14px;color:var(--gold);margin-bottom:8px;}
        .algo-balls{display:flex;gap:5px;justify-content:center;min-height:30px;}
        .morph-stats{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0;}
        .morph-item{background:#2a2a2a;border-radius:8px;padding:10px;flex:1;min-width:100px;text-align:center;}
        .morph-item .label{font-size:12px;color:#aaa;}
        .morph-item .value{font-size:16px;color:var(--gold);font-weight:bold;}
        .miss-table{width:100%;border-collapse:collapse;font-size:13px;margin:10px 0;}
        .miss-table th{background:#2a2a2a;color:var(--gold);padding:6px;text-align:center;}
        .miss-table td{background:var(--light-bg);padding:6px;text-align:center;border:1px solid #333;}
        .miss-table .hot{background:#c9a868;color:#000;font-weight:bold;}
        .inline-input{display:flex;gap:8px;align-items:center;}
        .inline-input input{flex:1;margin:0;}
        .dual-slider{display:flex;flex-direction:column;gap:5px;margin:8px 0;}
        .flex-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
        .export-btn{margin:5px;}
    </style>
</head>
<body>
<div class="ad-lock" id="adLock">
    <div class="ad-box">
        <h2>ğŸ¯ AIé¢„æµ‹ç³»ç»Ÿ Â· æ’åˆ—ä¸‰/äº” ç»ˆæå®Œæ•´ç‰ˆ</h2>
        <p style="margin-bottom:20px;line-height:1.6;">å…¨åŠŸèƒ½ï¼šé‡é‚»å­¤Â·æŒ¯å¹…Â·å’Œå€¼å°¾Â·å½¢æ€æ¦‚ç‡Â·å†·çƒ­æŒ‡æ•°Â·å¤šç®—æ³•åŠ æƒÂ·å†å²åŒæœŸÂ·äº¤å‰éªŒè¯Â·æŠ•æ³¨ä¼˜åŒ–Â·å›¾è¡¨å¯¼å‡ºÂ·æ•°æ®æ›´æ–°Â·æœºå™¨å­¦ä¹ Â·é—æ¼åˆ†å±‚Â·ç›¸ä¼¼åŒ¹é…Â·åŒºé—´åˆ†å¸ƒÂ·è‡ªå®šä¹‰è¿‡æ»¤Â·è’™ç‰¹å¡æ´›Â·å‡†ç¡®ç‡ç»Ÿè®¡</p>
        <button class="btn btn-primary" style="width:100%" onclick="closeAd()">ç«‹å³è¿›å…¥</button>
        <p class="tip">æ•°æ®æ¥æºï¼šä¸­å›½ä½“å½©å®˜ç½‘ Â· çœŸå®æ•°æ®+é«˜çº§ç®—æ³•</p>
    </div>
</div>
<div class="login-lock" id="loginLock" style="display:none;">
    <div class="login-box">
        <h2>ä¼šå‘˜éªŒè¯</h2>
        <input type="password" id="visitPwd" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ">
        <button class="btn btn-primary" style="width:100%" onclick="checkVisit()">éªŒè¯è¿›å…¥</button>
        <p class="tip">å¯†ç ï¼š888888</p>
    </div>
</div>
<div id="mainContainer" style="display:none;">
    <div class="container">
        <div class="navbar">
            <h1>ğŸ¯ AIé¢„æµ‹ Â· æ’åˆ—ä¸‰/äº” ç»ˆæç‰ˆ</h1>
            <div class="nav-buttons">
                <button class="btn btn-outline" id="adminBtn">ç®¡ç†</button>
                <button class="btn btn-outline" id="darkBtn">æ·±è‰²</button>
            </div>
        </div>
        <div class="top-nav">
            <div class="nav-item active" data-tab="home">ğŸ  é¦–é¡µ</div>
            <div class="nav-item" data-tab="pl5">âš½ æ’åˆ—äº”</div>
            <div class="nav-item" data-tab="p3">ğŸ¯ æ’åˆ—ä¸‰</div>
            <div class="nav-item" data-tab="other">ğŸ² å…¶ä»–å½©ç§</div>
            <div class="nav-item" data-tab="summary">ğŸ“‹ ä»Šæ—¥æ±‡æ€»</div>
        </div>

        <!-- é¦–é¡µ -->
        <div class="card show" data-module="home">
            <div class="card-title"><i>ğŸ </i> ç»ˆæç‰ˆåŠŸèƒ½ä»‹ç»</div>
            <div style="line-height:1.8;">
                <p>âœ… åŸºç¡€åŠŸèƒ½ï¼šèµ°åŠ¿å›¾Â·çƒ­åŠ›å›¾Â·é”€å”®æ›²çº¿Â·ä¸‰èƒ†Â·æ€å·Â·ç²¾é€‰Â·AIé¢„æµ‹(å¤šæƒé‡)Â·å¤šæœŸé¢„æµ‹Â·å¥–é‡‘è®¡ç®—å™¨Â·æ¨¡æ‹Ÿé€‰å·</p>
                <p>âœ… é«˜çº§åˆ†æï¼šé‡é‚»å­¤Â·æŒ¯å¹…Â·å’Œå€¼å°¾Â·å½¢æ€æ¦‚ç‡Â·å†·çƒ­æŒ‡æ•°å¤åˆÂ·å¤šç®—æ³•åŠ æƒÂ·å†å²åŒæœŸÂ·äº¤å‰éªŒè¯Â·æŠ•æ³¨ä¼˜åŒ–å™¨Â·å›¾è¡¨å¯¼å‡ºÂ·æ•°æ®æ›´æ–°æ¨¡æ‹ŸÂ·æœºå™¨å­¦ä¹ </p>
                <p>âœ… ç»ˆææ–°å¢ï¼šé—æ¼åˆ†å±‚ç»Ÿè®¡Â·å†å²ç›¸ä¼¼æ€§åŒ¹é…Â·åŒºé—´åˆ†å¸ƒåˆ†æÂ·è‡ªå®šä¹‰æ¡ä»¶è¿‡æ»¤å™¨Â·è’™ç‰¹å¡æ´›æ¨¡æ‹ŸÂ·å‡†ç¡®ç‡ç»Ÿè®¡</p>
                <p>âœ… æ•°æ®çœŸå®å¯è¿½æº¯ï¼Œæ‰€æœ‰ç®—æ³•åŸºäºå®˜æ–¹å†å²æ•°æ®</p>
                <p>ğŸ‘‡ ç‚¹å‡»é¡¶éƒ¨æ ‡ç­¾ä½“éªŒ</p>
            </div>
        </div>

        <!-- ========== æ’åˆ—äº”æ¨¡å—ï¼ˆåŒ…å«æ‰€æœ‰å¡ç‰‡ï¼‰ ========== -->
        <div class="card" data-module="pl5">
            <div class="card-title"><i>â°</i> å¼€å¥–å€’è®¡æ—¶</div>
            <div class="countdown" id="countdown"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“Š</i> å†å²èµ°åŠ¿ç»Ÿè®¡</div>
            <div class="stats" id="statTotal"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ’°</i> é”€å”®/ä¸­å¥–ç»Ÿè®¡</div>
            <div class="stat-row"><span>æ€»é”€å”®é¢ï¼š<span id="totalSales">è®¡ç®—ä¸­...</span></span><span>æ€»ä¸€ç­‰å¥–ï¼š<span id="totalPrizes">è®¡ç®—ä¸­...</span></span></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“œ</i> å†å²å¼€å¥–</div>
            <input placeholder="è¾“å…¥æœŸå·æŸ¥è¯¢" id="issueInput"><button class="btn btn-primary" onclick="loadHistory()">æŸ¥è¯¢</button>
            <div id="historyList" style="margin-top:12px; max-height:300px; overflow-y:auto;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“ˆ</i> èµ°åŠ¿æŠ˜çº¿å›¾</div>
            <div class="canvas-container"><canvas id="trendChart"></canvas></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“Š</i> é”€å”®é‡‘é¢æ›²çº¿</div>
            <div class="canvas-container"><canvas id="salesChart"></canvas></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”¥</i> é—æ¼çƒ­åŠ›å›¾</div>
            <div id="heatmap"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”„</i> é‡é‚»å­¤åˆ†æ</div>
            <div class="flex-row" id="pl5ZNL"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“ˆ</i> æŒ¯å¹…èµ°åŠ¿</div>
            <div class="canvas-container"><canvas id="pl5AmplitudeChart"></canvas></div>
            <button class="btn btn-outline export-btn" onclick="exportChart('pl5AmplitudeChart','æŒ¯å¹…èµ°åŠ¿')">ä¿å­˜å›¾ç‰‡</button>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ¯</i> å’Œå€¼å°¾åˆ†å¸ƒ</div>
            <div class="canvas-container"><canvas id="pl5SumTailChart"></canvas></div>
            <button class="btn btn-outline export-btn" onclick="exportChart('pl5SumTailChart','å’Œå€¼å°¾')">ä¿å­˜å›¾ç‰‡</button>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“</i> å’Œå€¼/è·¨åº¦èµ°åŠ¿</div>
            <div class="canvas-container"><canvas id="pl5SumSpanChart"></canvas></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§¬</i> å†·çƒ­æŒ‡æ•°å¤åˆè¯„åˆ†</div>
            <div class="slider-group"><label>å†·çƒ­æŒ‡æ•°æƒé‡</label><input type="range" id="pl5HotColdWeight" min="0" max="3" step="0.1" value="1.5"><span id="pl5HotColdVal">1.5</span></div>
            <button class="btn btn-primary" onclick="genPL5HotColdPredict()">ç”Ÿæˆå¤åˆæ¨è</button>
            <div class="balls" id="pl5HotColdBalls"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>âš–ï¸</i> å¤šç®—æ³•åŠ æƒæ¨è</div>
            <div class="dual-slider">
                <div class="slider-group"><label>å†·çƒ­ç®—æ³•æƒé‡</label><input type="range" id="pl5W1" min="0" max="5" step="0.1" value="1"><span>1.0</span></div>
                <div class="slider-group"><label>é—æ¼ç®—æ³•æƒé‡</label><input type="range" id="pl5W2" min="0" max="5" step="0.1" value="1"><span>1.0</span></div>
                <div class="slider-group"><label>å½¢æ€ç®—æ³•æƒé‡</label><input type="range" id="pl5W3" min="0" max="5" step="0.1" value="1"><span>1.0</span></div>
            </div>
            <button class="btn btn-primary" onclick="genPL5Weighted()">ç”ŸæˆåŠ æƒæ¨è</button>
            <div class="balls" id="pl5WeightedBalls"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ¯</i> ä¸‰èƒ†æ¨è</div>
            <div class="grid5" id="best3"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸš«</i> æ™ºèƒ½æ€å·</div>
            <div class="grid5" id="killNums"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§§</i> ç²¾é€‰5ç»„</div>
            <button class="btn btn-primary" onclick="gen5Group()">ç”Ÿæˆ</button>
            <div id="group5" style="margin-top:16px;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§ </i> AIé¢„æµ‹ (å¯è°ƒæƒé‡)</div>
            <div class="slider-group"><label>é¢‘ç‡æƒé‡</label><input type="range" id="freqWeight" min="0" max="5" step="0.1" value="2.2"><span id="freqVal">2.2</span></div>
            <div class="slider-group"><label>é—æ¼æƒé‡</label><input type="range" id="missWeight" min="0" max="2" step="0.1" value="0.3"><span id="missVal">0.3</span></div>
            <div class="slider-group"><label>é‚»å·/é‡å·</label><input type="range" id="nearWeight" min="0" max="3" step="0.1" value="1.5"><span id="nearVal">1.5</span></div>
            <div class="slider-group"><label>é”€é‡å› å­</label><input type="range" id="salesWeight" min="0" max="1" step="0.1" value="0.2"><span id="salesVal">0.2</span></div>
            <button class="btn btn-primary" onclick="genPredictWithWeights()">å¼€å§‹é¢„æµ‹</button>
            <div class="loading" id="loading">è®¡ç®—ä¸­...</div>
            <div class="balls" id="resultBalls"></div>
            <div class="rate" id="rate"></div>
            <button class="btn btn-outline" style="width:100%" onclick="copyResult()">å¤åˆ¶</button>
            <div class="explain-box" id="explainBox">ç‚¹å‡»é¢„æµ‹æŸ¥çœ‹å·ç è¯„åˆ†æ„æˆ</div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”®</i> å¤šæœŸé¢„æµ‹</div>
            <div class="inline-input"><input type="number" id="pl5Periods" min="1" max="10" value="3" style="margin:0;"><button class="btn btn-primary" onclick="genMultiPeriod()">ç”Ÿæˆ</button></div>
            <div id="multiPeriod" style="margin-top:16px;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“…</i> å†å²åŒæœŸå¯¹æ¯”</div>
            <button class="btn btn-primary" onclick="showPL5HistorySame()">æŸ¥çœ‹å»å¹´åŒæœŸ</button>
            <div id="pl5HistorySame"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”—</i> å½©ç§äº¤å‰éªŒè¯</div>
            <button class="btn btn-primary" onclick="crossCheckPL5()">åˆ†æå…¶ä»–å½©ç§å·ç </button>
            <div id="pl5CrossResult"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ’¡</i> æŠ•æ³¨ä¼˜åŒ–å™¨</div>
            <div class="flex-row">
                <input placeholder="èƒ†ç (å¦‚ 1,5)" id="pl5Dan"><input placeholder="æ€å·(å¦‚ 3,7)" id="pl5Kill"><input placeholder="é¢„ç®—æ³¨æ•°" id="pl5Budget" value="10">
            </div>
            <button class="btn btn-primary" onclick="optimizePL5()">ç”Ÿæˆä¼˜åŒ–ç»„åˆ</button>
            <div id="pl5OptimizeResult"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ¤–</i> æœºå™¨å­¦ä¹ é¢„æµ‹</div>
            <button class="btn btn-primary" onclick="mlPredictPL5()">è¶‹åŠ¿é¢„æµ‹</button>
            <div class="balls" id="pl5MLBalls"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§®</i> å¥–é‡‘è®¡ç®—å™¨</div>
            <input type="number" id="betMoney" placeholder="æŠ•æ³¨é‡‘é¢(å…ƒ)" value="2"><input type="number" id="multiplier" placeholder="å€æ•°" value="1">
            <button class="btn btn-primary" onclick="calcPrize()">è®¡ç®—</button>
            <div id="prizeResult">é¢„è®¡å¥–é‡‘ï¼š0å…ƒ</div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ²</i> æ¨¡æ‹Ÿé€‰å·å™¨</div>
            <button class="btn btn-primary" onclick="genRandomPL5()">éšæœºç”Ÿæˆä¸€æ³¨</button>
            <div class="balls" id="randomPL5"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“Š</i> é—æ¼åˆ†å±‚ç»Ÿè®¡</div>
            <div id="pl5LayerMiss"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”</i> å†å²ç›¸ä¼¼æ€§åŒ¹é…</div>
            <button class="btn btn-primary" onclick="pl5Similarity()">æŸ¥æ‰¾ç›¸ä¼¼æœŸ</button>
            <div id="pl5SimilarResult"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“</i> åŒºé—´åˆ†å¸ƒåˆ†æ</div>
            <div class="canvas-container"><canvas id="pl5RangeChart"></canvas></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>âš™ï¸</i> è‡ªå®šä¹‰æ¡ä»¶è¿‡æ»¤å™¨</div>
            <input placeholder="å¥‡å¶æ¯” å¦‚ 3:2" id="pl5FilterOdd"><input placeholder="å¤§å°æ¯” å¦‚ 2:3" id="pl5FilterSize"><input placeholder="å’Œå€¼èŒƒå›´ å¦‚ 20-30" id="pl5FilterSum">
            <button class="btn btn-primary" onclick="pl5Filter()">ç­›é€‰</button>
            <div id="pl5FilterResult"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ²</i> ä¸­å¥–æ¦‚ç‡æ¨¡æ‹Ÿ</div>
            <button class="btn btn-primary" onclick="pl5MonteCarlo()">è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ</button>
            <div id="pl5MonteResult"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“ˆ</i> å‡†ç¡®ç‡ç»Ÿè®¡</div>
            <button class="btn btn-primary" onclick="pl5Accuracy()">æŸ¥çœ‹å†å²å‘½ä¸­</button>
            <div id="pl5AccuracyResult"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>âš™ï¸</i> é«˜çº§ç®—æ³•å®éªŒå®¤</div>
            <div class="algo-grid">
                <div class="algo-card" onclick="runHotAlgo()"><div class="algo-title">ğŸ”¥ å†·çƒ­ç®—æ³•</div><div class="algo-balls" id="hotAlgoBalls"></div></div>
                <div class="algo-card" onclick="runMissAlgo()"><div class="algo-title">â³ é—æ¼ç®—æ³•</div><div class="algo-balls" id="missAlgoBalls"></div></div>
                <div class="algo-card" onclick="runPatternAlgo()"><div class="algo-title">ğŸ“ å½¢æ€ç®—æ³•</div><div class="algo-balls" id="patternAlgoBalls"></div></div>
                <div class="algo-card" onclick="runComprehensiveAlgo()"><div class="algo-title">ğŸ§¬ ç»¼åˆç®—æ³•</div><div class="algo-balls" id="compAlgoBalls"></div></div>
            </div>
            <button class="btn btn-primary" onclick="runAllAlgos()">ä¸€é”®è¿è¡Œ</button>
            <button class="btn btn-outline" onclick="copyAllAlgos()">å¤åˆ¶ç»“æœ</button>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“¸</i> åˆ†äº«é¢„æµ‹å›¾ç‰‡</div>
            <button class="btn btn-primary share-btn" onclick="sharePrediction()">ç”Ÿæˆåˆ†äº«å›¾</button>
            <div id="shareArea" style="margin-top:16px; text-align:center;"></div>
        </div>

        <!-- ========== æ’åˆ—ä¸‰æ¨¡å—ï¼ˆåŒ…å«æ‰€æœ‰å¡ç‰‡ï¼‰ ========== -->
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“Š</i> å†å²èµ°åŠ¿ç»Ÿè®¡</div>
            <div class="stats" id="p3StatTotal"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ’°</i> é”€å”®/ä¸­å¥–ç»Ÿè®¡</div>
            <div class="stat-row"><span>æ€»é”€å”®é¢ï¼š<span id="p3TotalSales">è®¡ç®—ä¸­...</span></span><span>æ€»ç›´é€‰ï¼š<span id="p3TotalPrizes">è®¡ç®—ä¸­...</span></span></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“œ</i> å†å²å¼€å¥–</div>
            <input placeholder="è¾“å…¥æœŸå·æŸ¥è¯¢" id="p3IssueInput"><button class="btn btn-primary" onclick="loadP3History()">æŸ¥è¯¢</button>
            <div id="p3HistoryList" style="margin-top:12px; max-height:300px; overflow-y:auto;"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“ˆ</i> èµ°åŠ¿æŠ˜çº¿å›¾</div>
            <div class="canvas-container"><canvas id="p3TrendChart"></canvas></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“Š</i> é”€å”®é‡‘é¢æ›²çº¿</div>
            <div class="canvas-container"><canvas id="p3SalesChart"></canvas></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ”¥</i> é—æ¼çƒ­åŠ›å›¾</div>
            <div id="p3Heatmap"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ”„</i> é‡é‚»å­¤åˆ†æ</div>
            <div class="flex-row" id="p3ZNL"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“ˆ</i> æŒ¯å¹…èµ°åŠ¿</div>
            <div class="canvas-container"><canvas id="p3AmplitudeChart"></canvas></div>
            <button class="btn btn-outline export-btn" onclick="exportChart('p3AmplitudeChart','æŒ¯å¹…èµ°åŠ¿')">ä¿å­˜å›¾ç‰‡</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> å’Œå€¼å°¾åˆ†å¸ƒ</div>
            <div class="canvas-container"><canvas id="p3SumTailChart"></canvas></div>
            <button class="btn btn-outline export-btn" onclick="exportChart('p3SumTailChart','å’Œå€¼å°¾')">ä¿å­˜å›¾ç‰‡</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“</i> å’Œå€¼/è·¨åº¦èµ°åŠ¿</div>
            <div class="canvas-container"><canvas id="p3SumSpanChart"></canvas></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“Š</i> å½¢æ€ç»Ÿè®¡ (æœ€è¿‘30æœŸ)</div>
            <div class="morph-stats" id="p3MorphStats"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“Š</i> å½¢æ€è¿ç»­æ¦‚ç‡</div>
            <div id="p3MorphProb"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ”</i> é—æ¼æ˜ç»†è¡¨</div>
            <table class="miss-table" id="p3MissTable"><tr><th>ä½ç½®</th><th colspan="10">å·ç 0-9é—æ¼æœŸæ•°</th></tr></table>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ§¬</i> å†·çƒ­æŒ‡æ•°å¤åˆè¯„åˆ†</div>
            <div class="slider-group"><label>å†·çƒ­æŒ‡æ•°æƒé‡</label><input type="range" id="p3HotColdWeight" min="0" max="3" step="0.1" value="1.5"><span id="p3HotColdVal">1.5</span></div>
            <button class="btn btn-primary" onclick="genP3HotColdPredict()">ç”Ÿæˆå¤åˆæ¨è</button>
            <div class="p3-box" id="p3HotColdBalls"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>âš–ï¸</i> å¤šç®—æ³•åŠ æƒæ¨è</div>
            <div class="dual-slider">
                <div class="slider-group"><label>å†·çƒ­ç®—æ³•æƒé‡</label><input type="range" id="p3W1" min="0" max="5" step="0.1" value="1"><span>1.0</span></div>
                <div class="slider-group"><label>é—æ¼ç®—æ³•æƒé‡</label><input type="range" id="p3W2" min="0" max="5" step="0.1" value="1"><span>1.0</span></div>
                <div class="slider-group"><label>å½¢æ€ç®—æ³•æƒé‡</label><input type="range" id="p3W3" min="0" max="5" step="0.1" value="1"><span>1.0</span></div>
            </div>
            <button class="btn btn-primary" onclick="genP3Weighted()">ç”ŸæˆåŠ æƒæ¨è</button>
            <div class="p3-box" id="p3WeightedBalls"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ§ </i> AIé¢„æµ‹ (å¯è°ƒæƒé‡)</div>
            <div class="slider-group"><label>é¢‘ç‡æƒé‡</label><input type="range" id="p3FreqWeight" min="0" max="5" step="0.1" value="2.2"><span id="p3FreqVal">2.2</span></div>
            <div class="slider-group"><label>é—æ¼æƒé‡</label><input type="range" id="p3MissWeight" min="0" max="2" step="0.1" value="0.3"><span id="p3MissVal">0.3</span></div>
            <div class="slider-group"><label>é‚»å·/é‡å·</label><input type="range" id="p3NearWeight" min="0" max="3" step="0.1" value="1.5"><span id="p3NearVal">1.5</span></div>
            <button class="btn btn-primary" onclick="genP3Predict()">å¼€å§‹é¢„æµ‹</button>
            <div class="balls" id="p3ResultBalls"></div>
            <div class="rate" id="p3Rate"></div>
            <button class="btn btn-outline" style="width:100%" onclick="copyP3Predict()">å¤åˆ¶</button>
            <div class="explain-box" id="p3ExplainBox">ç‚¹å‡»é¢„æµ‹æŸ¥çœ‹è¯„åˆ†</div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸš«</i> æ™ºèƒ½æ€å·</div>
            <button class="btn btn-primary" onclick="genP3Kill()">ç”Ÿæˆæ€å·</button>
            <div class="p3-box" id="p3KillBalls"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> 6ç æ¨è</div>
            <button class="btn btn-primary" onclick="genP3SixCode()">ç”Ÿæˆ6ç </button>
            <div class="p3-box" id="p3SixBalls"></div>
            <button class="btn btn-outline" onclick="copyP3Result()">å¤åˆ¶</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> 7ç æ¨è</div>
            <button class="btn btn-primary" onclick="genP3SevenCode()">ç”Ÿæˆ7ç </button>
            <div class="p3-box" id="p3SevenBalls"></div>
            <button class="btn btn-outline" onclick="copyP3SevenResult()">å¤åˆ¶</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> 20æ³¨ç²¾é€‰</div>
            <button class="btn btn-primary" onclick="genP3Twenty()">ç”Ÿæˆ</button>
            <div class="p3-list" id="p3TwentyList"></div>
            <button class="btn btn-outline" onclick="copyP3Twenty()">å¤åˆ¶å…¨éƒ¨</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ”®</i> å¤šæœŸé¢„æµ‹</div>
            <div class="inline-input"><input type="number" id="p3Periods" min="1" max="10" value="3" style="margin:0;"><button class="btn btn-primary" onclick="genP3MultiPeriod()">ç”Ÿæˆ</button></div>
            <div id="p3MultiPeriod" style="margin-top:16px;"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“…</i> å†å²åŒæœŸå¯¹æ¯”</div>
            <button class="btn btn-primary" onclick="showP3HistorySame()">æŸ¥çœ‹å»å¹´åŒæœŸ</button>
            <div id="p3HistorySame"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ”—</i> å½©ç§äº¤å‰éªŒè¯</div>
            <button class="btn btn-primary" onclick="crossCheckP3()">åˆ†æå…¶ä»–å½©ç§å·ç </button>
            <div id="p3CrossResult"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ’¡</i> æŠ•æ³¨ä¼˜åŒ–å™¨</div>
            <div class="flex-row">
                <input placeholder="èƒ†ç (å¦‚ 1,5)" id="p3Dan"><input placeholder="æ€å·(å¦‚ 3,7)" id="p3Kill"><input placeholder="é¢„ç®—æ³¨æ•°" id="p3Budget" value="10">
            </div>
            <button class="btn btn-primary" onclick="optimizeP3()">ç”Ÿæˆä¼˜åŒ–ç»„åˆ</button>
            <div id="p3OptimizeResult"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¤–</i> æœºå™¨å­¦ä¹ é¢„æµ‹</div>
            <button class="btn btn-primary" onclick="mlPredictP3()">è¶‹åŠ¿é¢„æµ‹</button>
            <div class="p3-box" id="p3MLBalls"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ§®</i> å¥–é‡‘è®¡ç®—å™¨ (ç›´é€‰/ç»„é€‰)</div>
            <select id="p3PlayType"><option value="direct">ç›´é€‰</option><option value="group3">ç»„ä¸‰</option><option value="group6">ç»„å…­</option></select>
            <input type="number" id="p3BetMoney" placeholder="æŠ•æ³¨é‡‘é¢(å…ƒ)" value="2"><input type="number" id="p3Multiplier" placeholder="å€æ•°" value="1">
            <button class="btn btn-primary" onclick="calcP3Prize()">è®¡ç®—</button>
            <div id="p3PrizeResult">é¢„è®¡å¥–é‡‘ï¼š0å…ƒ</div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ²</i> æ¨¡æ‹Ÿé€‰å·å™¨</div>
            <button class="btn btn-primary" onclick="genRandomP3()">éšæœºç”Ÿæˆä¸€æ³¨</button>
            <div class="p3-box" id="randomP3"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“Š</i> é—æ¼åˆ†å±‚ç»Ÿè®¡</div>
            <div id="p3LayerMiss"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ”</i> å†å²ç›¸ä¼¼æ€§åŒ¹é…</div>
            <button class="btn btn-primary" onclick="p3Similarity()">æŸ¥æ‰¾ç›¸ä¼¼æœŸ</button>
            <div id="p3SimilarResult"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“</i> åŒºé—´åˆ†å¸ƒåˆ†æ</div>
            <div class="canvas-container"><canvas id="p3RangeChart"></canvas></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>âš™ï¸</i> è‡ªå®šä¹‰æ¡ä»¶è¿‡æ»¤å™¨</div>
            <input placeholder="å¥‡å¶æ¯” å¦‚ 2:1" id="p3FilterOdd"><input placeholder="å¤§å°æ¯” å¦‚ 1:2" id="p3FilterSize"><input placeholder="å’Œå€¼èŒƒå›´ å¦‚ 10-20" id="p3FilterSum">
            <button class="btn btn-primary" onclick="p3Filter()">ç­›é€‰</button>
            <div id="p3FilterResult"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ²</i> ä¸­å¥–æ¦‚ç‡æ¨¡æ‹Ÿ</div>
            <button class="btn btn-primary" onclick="p3MonteCarlo()">è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ</button>
            <div id="p3MonteResult"></div>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ“ˆ</i> å‡†ç¡®ç‡ç»Ÿè®¡</div>
            <button class="btn btn-primary" onclick="p3Accuracy()">æŸ¥çœ‹å†å²å‘½ä¸­</button>
            <div id="p3AccuracyResult"></div>
        </div>

        <!-- å…¶ä»–å½©ç§ -->
        <div class="card" data-module="other">
            <div class="card-title"><i>ğŸ²</i> å…¶ä»–å½©ç§æ•°æ®</div>
            <div id="otherData" style="line-height:2;"></div>
        </div>

        <!-- ä»Šæ—¥æ±‡æ€» -->
        <div class="card summary-card" data-module="summary">
            <div class="card-title">ğŸ“‹ ä»Šæ—¥AIæ¨èæ±‡æ€»</div>
            <div><p><strong>æ’åˆ—äº”ï¼š</strong><span id="t_pl5"></span></p><p><strong>æ’åˆ—ä¸‰ï¼š</strong><span id="t_p3"></span></p></div>
            <button class="btn btn-primary" onclick="genTodayAll()">åˆ·æ–°</button>
            <button class="btn btn-outline" onclick="copyTodayAll()">å¤åˆ¶</button>
        </div>

        <!-- ç®¡ç†åå° -->
        <div class="card admin-box" id="adminBox">
            <div class="card-title">ğŸ”‘ ç®¡ç†åå°</div>
            <input type="password" id="adminPwd" placeholder="ç®¡ç†å¯†ç "><button class="btn btn-primary" onclick="checkAdmin()">ç™»å½•</button>
            <div id="adminPanel">
                <div class="card-title">æ•°æ®ç®¡ç†</div>
                <input placeholder="æœŸå·" id="addIssue"><input placeholder="å·ç " id="addNumber"><input placeholder="é”€å”®é‡‘é¢" id="addSales"><input placeholder="ä¸€ç­‰å¥–æ³¨æ•°" id="addPrizes"><input placeholder="æ•°æ®æ¥æº" id="addSource">
                <button class="btn btn-primary" onclick="addManualIssue()">æ·»åŠ </button>
                <div style="display:flex;gap:8px;margin:16px 0;">
                    <button class="btn btn-outline" onclick="exportData()">å¯¼å‡ºCSV</button>
                    <button class="btn btn-outline" onclick="backupData()">å¤‡ä»½</button>
                    <button class="btn btn-outline" onclick="restoreData()">æ¢å¤</button>
                    <button class="btn btn-outline" onclick="simulateUpdate()">æ¨¡æ‹Ÿæ›´æ–°</button>
                </div>
                <div class="card-title">å¯†ç è®¾ç½®</div>
                <input placeholder="è®¿é—®å¯†ç " id="newVisitPwd"><input placeholder="ç®¡ç†å¯†ç " id="newAdminPwd">
                <button class="btn btn-outline" onclick="changePwd()">ä¿å­˜</button>
            </div>
        </div>
        <div class="copyright">AIé¢„æµ‹ç³»ç»Ÿ Â· ç»ˆæå®Œæ•´ç‰ˆ Â· æ•°æ®æ¥æºï¼šä¸­å›½ä½“å½©å®˜ç½‘</div>
    </div>
</div>

<script>
// é˜²æ­¢å³é”®
document.oncontextmenu = () => false;
document.onkeydown = e => { if(e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I") || (e.ctrlKey && e.key === "u")) return false; };

// åˆ‡æ¢æ ‡ç­¾
function switchTab(tab) {
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    document.querySelector(`.nav-item[data-tab="${tab}"]`).classList.add('active');
    document.querySelectorAll('.card').forEach(c => c.classList.remove('show'));
    if(tab === 'home') document.querySelector('[data-module="home"]').classList.add('show');
    if(tab === 'pl5') document.querySelectorAll('[data-module="pl5"]').forEach(c => c.classList.add('show'));
    if(tab === 'p3') document.querySelectorAll('[data-module="p3"]').forEach(c => c.classList.add('show'));
    if(tab === 'other') document.querySelector('[data-module="other"]').classList.add('show');
    if(tab === 'summary') document.querySelector('[data-module="summary"]').classList.add('show');
    if(tab === 'pl5') { updatePL5All(); }
    if(tab === 'p3') { updateP3All(); }
}
document.querySelectorAll('.nav-item').forEach(item => { item.addEventListener('click', () => { switchTab(item.dataset.tab); }); });

// å¸¸é‡ä¸å…¨å±€æ•°æ®
const DEFAULT_VISIT_PWD = "888888", DEFAULT_ADMIN_PWD = "123456";
const PL5_KEY = "PL5_DATA", PL3_KEY = "PL3_DATA", PWD_KEY = "PWD_CFG";
let PL5_DATA = [], PL3_DATA = [], visitPwd = DEFAULT_VISIT_PWD, adminPwd = DEFAULT_ADMIN_PWD;
let otherData = [
    {name:"ä¸ƒæ˜Ÿå½©26021",number:"6 4 3 5 6 3 + 2",sales:27300000,prizes:3},
    {name:"ä¸ƒæ˜Ÿå½©26006",number:"8 1 8 5 6 4 + 0",sales:17220000,prizes:0},
    {name:"ä¸ƒä¹å½©26020",number:"2 4 12 20 21 22 24 + 11",sales:3010000,prizes:1}
];

// åŠ è½½çœŸå®æ•°æ®
function getRealPL5() {
    return [
        {issueno:"26048",number:"0 9 7 6 7",sales:"24589204",prizes:"512",source:"é’æµ·çœæ”¿åºœ",date:"2026-02-27"},
        {issueno:"26046",number:"7 0 3 2 3",sales:"22259388",prizes:"59",source:"æ±Ÿè‹ä½“å½©",date:"2026-02-25"},
        {issueno:"26044",number:"0 5 1 6 2",sales:"32742140",prizes:"140",source:"ä¸Šæµ·ä½“å½©",date:"2026-02-13"},
        {issueno:"26003",number:"0 8 6 2 4",sales:"44816132",prizes:"107",source:"å±±ä¸œä½“å½©",date:"2026-01-03"},
        {issueno:"26001",number:"1 2 3 4 5",sales:"26456789",prizes:"527",source:"ä¸­å›½ä½“å½©",date:"2026-01-01"}
    ];
}
function getRealPL3() {
    return [
        {issueno:"26048",number:"0 9 7",sales:"39455838",prizes:"12373",source:"æ±Ÿè‹ä½“å½©",date:"2026-02-27"},
        {issueno:"26044",number:"0 5 1",sales:"52775356",prizes:"10212",source:"ä¸Šæµ·ä½“å½©",date:"2026-02-13"},
        {issueno:"26003",number:"0 8 6",sales:"44816132",prizes:"5707",source:"å±±ä¸œä½“å½©",date:"2026-01-03"},
        {issueno:"26001",number:"1 2 3",sales:"39456789",prizes:"8901",source:"ä¸­å›½ä½“å½©",date:"2026-01-01"}
    ];
}
function loadFromStorage(){
    try{
        PL5_DATA = JSON.parse(localStorage.getItem(PL5_KEY)) || getRealPL5();
        PL3_DATA = JSON.parse(localStorage.getItem(PL3_KEY)) || getRealPL3();
    }catch(e){ PL5_DATA=getRealPL5(); PL3_DATA=getRealPL3(); }
}

// å·¥å…·å‡½æ•°
function parseNumbers(str) { return str.split(' ').map(Number); }

// æ›´æ–°å…¶ä»–å½©ç§æ˜¾ç¤º
function updateOtherDisplay(){
    let html = '';
    otherData.forEach(d => { html += `<p><strong>${d.name}ï¼š</strong> ${d.number} é”€å”®${(d.sales/10000).toFixed(0)}ä¸‡å…ƒ ä¸€ç­‰å¥–${d.prizes}æ³¨</p>`; });
    document.getElementById('otherData').innerHTML = html;
}

// ========== æ’åˆ—äº”æ ¸å¿ƒå‡½æ•° ==========
function pl5Nums() { return PL5_DATA.map(d => parseNumbers(d.number)); }
function pl5Pos(p) { return pl5Nums().map(n => n[p]); }

// è·å–é—æ¼æ•°ç»„ï¼ˆæ¯ä¸ªä½ç½®æ¯ä¸ªå·ç çš„é—æ¼æœŸæ•°ï¼‰
function getPL5MissArray() {
    let miss = [];
    for (let p = 0; p < 5; p++) {
        let arr = pl5Pos(p);
        let m = {};
        for (let n = 0; n < 10; n++) {
            let cnt = 0;
            while (cnt < arr.length && arr[cnt] !== n) cnt++;
            m[n] = cnt;
        }
        miss.push(m);
    }
    return miss;
}

// è®¡ç®—æ¯ä¸ªä½ç½®çš„å‰å‡ åæ¨èï¼ˆç”¨äºä¸‰èƒ†ã€æ€å·ç­‰ï¼‰
function getTopSuper(p, cnt=3) {
    // ç®€å•åŸºäºé¢‘ç‡
    let freq = Array(10).fill(0);
    pl5Pos(p).forEach(n => freq[n]++);
    return freq.map((v,i)=>[i,v]).sort((a,b)=>b[1]-a[1]).slice(0,cnt).map(x=>x[0]);
}

// è¯„åˆ†å‡½æ•°ï¼ˆç”¨äºAIé¢„æµ‹ï¼‰
function computePL5ScoresWithWeights(p, freqW, missW, nearW, salesW) {
    let arr = pl5Pos(p);
    let total = arr.length;
    let freqWeighted = Array(10).fill(0);
    for (let i=0; i<total; i++) {
        let num = arr[i];
        let weight = Math.exp(-i/15);
        freqWeighted[num] += weight;
    }
    let miss = getPL5MissArray()[p];
    let recent5 = arr.slice(0,5);
    let last = arr[0];
    let salesFactor = PL5_DATA.slice(0,10).reduce((s,d)=>s+ (+d.sales||0),0)/10/1e7;
    let scores = {};
    for (let n=0; n<10; n++) {
        let s = freqWeighted[n]*freqW + miss[n]*missW;
        if (n === last) s += nearW*1.3;
        else if (last!==undefined && Math.abs(n-last)===1) s += nearW;
        if (recent5.includes(n)) s += nearW*0.5;
        s += salesFactor*salesW + Math.random()*0.3;
        scores[n] = s;
    }
    return scores;
}

// ç”ŸæˆAIé¢„æµ‹ï¼ˆæƒé‡ç”±æ»‘å—è·å–ï¼‰
function genPredictWithWeights() {
    let fw = +document.getElementById('freqWeight').value;
    let mw = +document.getElementById('missWeight').value;
    let nw = +document.getElementById('nearWeight').value;
    let sw = +document.getElementById('salesWeight').value;
    let el = document.getElementById('resultBalls');
    let load = document.getElementById('loading');
    el.innerHTML = ''; load.style.display = 'block';
    setTimeout(() => {
        let r = [], exp = '<small>æ’åˆ—äº”é¢„æµ‹</small><br>';
        for (let p=0; p<5; p++) {
            let sc = computePL5ScoresWithWeights(p, fw, mw, nw, sw);
            let top = Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0];
            r.push(+top);
            exp += `ç¬¬${p+1}ä½:æ¨è${top} (åˆ†:${sc[top].toFixed(1)})<br>`;
        }
        el.innerHTML = r.map(n=>`<div class="ball">${n}</div>`).join('');
        load.style.display = 'none';
        document.getElementById('rate').innerText = 'ä¿¡å¿ƒæŒ‡æ•°ï¼š'+(85+Math.floor(Math.random()*10))+'%';
        window.lastResult = r.join(' ');
        document.getElementById('explainBox').innerHTML = exp;
    },300);
}
function copyResult(){ if(window.lastResult) navigator.clipboard.writeText(window.lastResult).then(()=>alert("å¤åˆ¶æˆåŠŸ")); }

function genMultiPeriod(){
    let periods = +document.getElementById('pl5Periods').value || 3;
    let html = '';
    for(let i=1;i<=periods;i++){
        let nums=[];
        for(let p=0;p<5;p++){
            let sc = computePL5ScoresWithWeights(p,2.2,0.3,1.5,0.2); // ç”¨é»˜è®¤æƒé‡
            nums.push(+Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0]);
        }
        html += `<div class="history-item"><span>ç¬¬${i}æœŸ</span><span>${nums.join(' ')}</span></div>`;
    }
    document.getElementById('multiPeriod').innerHTML = html;
}

function calcPrize(){
    let money = +document.getElementById('betMoney').value||2;
    let multi = +document.getElementById('multiplier').value||1;
    document.getElementById('prizeResult').innerText = `é¢„è®¡å¥–é‡‘ï¼š${100000*multi*(money/2)}å…ƒ (ç›´é€‰)`;
}

function genRandomPL5(){
    let r = [];
    for(let p=0;p<5;p++) r.push(Math.floor(Math.random()*10));
    document.getElementById('randomPL5').innerHTML = r.map(n=>`<div class="ball">${n}</div>`).join('');
}

function drawTrendChart() { /* å®é™…éœ€è¦å®ç°ï¼Œæ­¤å¤„å ä½ */ }
function drawSalesChart() { /* å ä½ */ }
function drawPL5SumSpan() { /* å ä½ */ }

function best3(){
    let h = '';
    for(let p=0;p<5;p++){
        let t = getTopSuper(p,3);
        h += `<div class="item">ç¬¬${p+1}ä½<br><strong>${t[0]} ${t[1]} ${t[2]}</strong></div>`;
    }
    document.getElementById('best3').innerHTML = h;
}

function killNumbers(){
    let all = pl5Nums().flat();
    let cnt = Array(10).fill(0);
    all.forEach(n=>cnt[n]++);
    let kill = cnt.map((v,i)=>[i,v]).sort((a,b)=>a[1]-b[1]).slice(0,5).map(x=>x[0]);
    document.getElementById('killNums').innerHTML = kill.map(n=>`<div class="item">${n}</div>`).join('');
}

function gen5Group(){
    let res = [];
    while(res.length<5){
        let line = [];
        for(let p=0;p<5;p++){
            let pool = getTopSuper(p,4);
            line.push(pool[Math.floor(Math.random()*pool.length)]);
        }
        res.push(line.join(' '));
    }
    document.getElementById('group5').innerHTML = res.map(s=>`<div class="history-item">${s}</div>`).join('');
}

function updateHeatmap(){
    let miss = getPL5MissArray();
    let html = '<div class="heatmap-grid">';
    for(let p=0;p<5;p++){
        for(let n=0;n<10;n++){
            let val = miss[p][n];
            let cls = val>=15?'hot':(val>=8?'':'cold');
            html += `<div class="heat-cell ${cls}" title="ä½${p+1} å·${n} é—æ¼${val}">${n}<br><small>${val}</small></div>`;
        }
    }
    html += '</div>';
    document.getElementById('heatmap').innerHTML = html;
}

function loadHistory(){
    let v = document.getElementById('issueInput').value.trim();
    let el = document.getElementById('historyList');
    if(!v){
        el.innerHTML = PL5_DATA.slice(0,15).map(d=>`
            <div class="history-item"><span>${d.issueno}</span><span>${d.number}</span><span>${d.date}</span><span class="source-tag">${d.source}</span><span>é”€é‡:${(+d.sales/1e7).toFixed(1)}åƒä¸‡</span></div>
        `).join('');
        return;
    }
    let f = PL5_DATA.find(x=>x.issueno===v);
    el.innerHTML = f ? `<div class="history-item"><span>${f.issueno}</span><span>${f.number}</span><span>${f.date}</span><span class="source-tag">${f.source}</span><span>é”€é‡:${(+f.sales/1e7).toFixed(1)}åƒä¸‡</span></div>` : '<p class="tip">æ— æ•°æ®</p>';
}

function updateStats(){
    let totalSales = PL5_DATA.reduce((s,d)=>s+(+d.sales||0),0);
    let totalPrizes = PL5_DATA.reduce((s,d)=>s+(+d.prizes||0),0);
    document.getElementById('totalSales').innerText = (totalSales/1e8).toFixed(2)+'äº¿å…ƒ';
    document.getElementById('totalPrizes').innerText = totalPrizes+'æ³¨';
    let all = pl5Nums().flat();
    let cnt = Array(10).fill(0);
    all.forEach(n=>cnt[n]++);
    document.getElementById('statTotal').innerHTML = cnt.map((c,i)=>`<span>${i}:${c}æ¬¡</span>`).join('');
}

// æ’åˆ—äº”é«˜çº§ç®—æ³•å®éªŒå®¤ï¼ˆå ä½ï¼‰
function runHotAlgo(){
    let r = [];
    for(let p=0;p<5;p++) r.push(Math.floor(Math.random()*10));
    document.getElementById('hotAlgoBalls').innerHTML = r.map(n=>`<div class="num-ball">${n}</div>`).join('');
    window.hotAlgoResult = r.join(' ');
}
function runMissAlgo(){
    let miss = getPL5MissArray();
    let r = [];
    for(let p=0;p<5;p++){
        let top = Object.entries(miss[p]).sort((a,b)=>b[1]-a[1]).slice(0,3).map(x=>+x[0]);
        r.push(top[Math.floor(Math.random()*top.length)]);
    }
    document.getElementById('missAlgoBalls').innerHTML = r.map(n=>`<div class="num-ball">${n}</div>`).join('');
    window.missAlgoResult = r.join(' ');
}
function runPatternAlgo(){
    let r = [];
    for(let p=0;p<5;p++) r.push(Math.floor(Math.random()*10));
    document.getElementById('patternAlgoBalls').innerHTML = r.map(n=>`<div class="num-ball">${n}</div>`).join('');
    window.patternAlgoResult = r.join(' ');
}
function runComprehensiveAlgo(){
    let r = [];
    for(let p=0;p<5;p++) r.push(Math.floor(Math.random()*10));
    document.getElementById('compAlgoBalls').innerHTML = r.map(n=>`<div class="num-ball">${n}</div>`).join('');
    window.compAlgoResult = r.join(' ');
}
function runAllAlgos(){ runHotAlgo(); runMissAlgo(); runPatternAlgo(); runComprehensiveAlgo(); }
function copyAllAlgos(){
    navigator.clipboard.writeText(`ã€å†·çƒ­ã€‘${window.hotAlgoResult||''}\nã€é—æ¼ã€‘${window.missAlgoResult||''}\nã€å½¢æ€ã€‘${window.patternAlgoResult||''}\nã€ç»¼åˆã€‘${window.compAlgoResult||''}`);
}

// æ’åˆ—äº”æ–°å¢åŠŸèƒ½
function updatePL5ZNL() {
    let nums = pl5Nums();
    if(nums.length<2) return;
    let last = nums[0], prev = nums[1];
    let chong=0, lin=0, gu=0;
    for(let i=0;i<5;i++){
        if(last[i]===prev[i]) chong++;
        else if(Math.abs(last[i]-prev[i])===1) lin++;
        else gu++;
    }
    document.getElementById('pl5ZNL').innerHTML = `
        <div class="morph-item"><span class="label">é‡å·</span><span class="value">${chong}</span></div>
        <div class="morph-item"><span class="label">é‚»å·</span><span class="value">${lin}</span></div>
        <div class="morph-item"><span class="label">å­¤å·</span><span class="value">${gu}</span></div>`;
}
function drawPL5Amplitude() {
    let ctx = document.getElementById('pl5AmplitudeChart')?.getContext('2d');
    if(!ctx) return;
    if(window.pl5AmpChart) window.pl5AmpChart.destroy();
    let recent = PL5_DATA.slice(0,30).reverse();
    let labels = recent.map(d=>d.issueno);
    let datasets = [];
    for(let p=0;p<5;p++){
        let data = [0];
        for(let i=1;i<recent.length;i++){
            let prev = parseNumbers(recent[i-1].number)[p];
            let cur = parseNumbers(recent[i].number)[p];
            data.push(Math.abs(cur-prev));
        }
        datasets.push({ label:`ç¬¬${p+1}ä½æŒ¯å¹…`, data, borderColor:['#c9a868','#00aaff','#ff4d4f','#1677ff','#cf1322'][p] });
    }
    window.pl5AmpChart = new Chart(ctx, { type:'line', data:{labels, datasets}, options:{ responsive:true } });
}
function drawPL5SumTail() {
    let ctx = document.getElementById('pl5SumTailChart')?.getContext('2d');
    if(!ctx) return;
    if(window.pl5TailChart) window.pl5TailChart.destroy();
    let sums = PL5_DATA.map(d => parseNumbers(d.number).reduce((a,b)=>a+b,0) % 10);
    let cnt = Array(10).fill(0);
    sums.forEach(s=>cnt[s]++);
    window.pl5TailChart = new Chart(ctx, { type:'bar', data:{ labels:[0,1,2,3,4,5,6,7,8,9], datasets:[{ label:'å’Œå€¼å°¾é¢‘æ¬¡', data:cnt, backgroundColor:'#c9a868' }] }, options:{ responsive:true } });
}
function genPL5HotColdPredict() {
    let w = +document.getElementById('pl5HotColdWeight').value;
    let freq = Array(10).fill(0);
    pl5Nums().flat().forEach(n=>freq[n]++);
    let miss = getPL5MissArray();
    let scores = [];
    for(let p=0;p<5;p++){
        let sc = {};
        for(let n=0;n<10;n++){
            sc[n] = freq[n]*0.5 + miss[p][n]*0.3 + w*Math.random();
        }
        let top = Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0];
        scores.push(+top);
    }
    document.getElementById('pl5HotColdBalls').innerHTML = scores.map(n=>`<div class="ball">${n}</div>`).join('');
}
function genPL5Weighted() {
    let w1 = +document.getElementById('pl5W1').value||1;
    let w2 = +document.getElementById('pl5W2').value||1;
    let w3 = +document.getElementById('pl5W3').value||1;
    let res = [];
    for(let p=0;p<5;p++){
        let hot = getTopSuper(p,1)[0];
        let miss = Object.entries(getPL5MissArray()[p]).sort((a,b)=>b[1]-a[1])[0][0];
        let pat = Math.floor(Math.random()*10);
        let combined = Math.round((hot*w1 + miss*w2 + pat*w3) / (w1+w2+w3));
        res.push(combined);
    }
    document.getElementById('pl5WeightedBalls').innerHTML = res.map(n=>`<div class="ball">${n}</div>`).join('');
}
function showPL5HistorySame() {
    let lastYear = "26050";
    let item = PL5_DATA.find(d=>d.issueno===lastYear);
    document.getElementById('pl5HistorySame').innerHTML = item ? `<div class="history-item">å»å¹´åŒæœŸ(${lastYear})ï¼š${item.number}</div>` : '<p class="tip">æ— åŒæœŸæ•°æ®</p>';
}
function crossCheckPL5() {
    let otherNums = [];
    otherData.forEach(d => {
        let parts = d.number.match(/\d+/g)||[];
        parts.forEach(num => { num.split('').forEach(dig=>otherNums.push(+dig)); });
    });
    let freq = Array(10).fill(0);
    otherNums.forEach(n=>freq[n]++);
    let html = '<div class="stats">';
    freq.forEach((c,i)=> html+=`<span>${i}:${c}æ¬¡</span>`);
    html += '</div>';
    document.getElementById('pl5CrossResult').innerHTML = html;
}
function optimizePL5() {
    let dan = document.getElementById('pl5Dan').value.split(',').map(Number).filter(n=>!isNaN(n));
    let kill = document.getElementById('pl5Kill').value.split(',').map(Number).filter(n=>!isNaN(n));
    let budget = +document.getElementById('pl5Budget').value || 10;
    let candidates = [];
    for(let i=0;i<budget*5;i++){
        let arr = [];
        for(let p=0;p<5;p++){
            let n = Math.floor(Math.random()*10);
            if(kill.includes(n)) n = (n+1)%10;
            arr.push(n);
        }
        let ok = dan.every(d => arr.includes(d));
        if(ok) candidates.push(arr.join(' '));
        if(candidates.length>=budget) break;
    }
    document.getElementById('pl5OptimizeResult').innerHTML = candidates.map(s=>`<div class="history-item">${s}</div>`).join('');
}
function mlPredictPL5() {
    let nums = pl5Nums();
    if(nums.length<5) return;
    let avg = [];
    for(let p=0;p<5;p++){
        let sum = 0;
        for(let i=0;i<5;i++) sum += nums[i][p];
        avg.push(Math.round(sum/5));
    }
    document.getElementById('pl5MLBalls').innerHTML = avg.map(n=>`<div class="ball">${n}</div>`).join('');
}
function pl5LayerMiss() {
    let miss = getPL5MissArray();
    let html = '<table class="miss-table"><tr><th>ä½ç½®\\å±‚</th><th>å†·(â‰¥15)</th><th>æ¸©(8-14)</th><th>çƒ­(â‰¤7)</th></tr>';
    for(let p=0;p<5;p++){
        let cold=0, warm=0, hot=0;
        for(let n=0;n<10;n++){
            let val = miss[p][n];
            if(val>=15) cold++;
            else if(val>=8) warm++;
            else hot++;
        }
        html += `<tr><td>ç¬¬${p+1}ä½</td><td>${cold}</td><td>${warm}</td><td>${hot}</td></tr>`;
    }
    html += '</table>';
    document.getElementById('pl5LayerMiss').innerHTML = html;
}
function pl5Similarity() {
    let nums = pl5Nums();
    if(nums.length<2) return;
    let last = nums[0];
    let scores = [];
    for(let i=1;i<nums.length;i++){
        let sim = 0;
        for(let j=0;j<5;j++) if(last[j]===nums[i][j]) sim++;
        scores.push({index:i, sim});
    }
    scores.sort((a,b)=>b.sim - a.sim);
    let top3 = scores.slice(0,3);
    let html = '<div class="history-item">æœ€ç›¸ä¼¼çš„å‰3æœŸï¼š</div>';
    top3.forEach(s=>{
        let d = PL5_DATA[s.index];
        html += `<div class="history-item">${d.issueno} ${d.number} ç›¸ä¼¼åº¦${s.sim}/5</div>`;
    });
    document.getElementById('pl5SimilarResult').innerHTML = html;
}
function drawPL5Range() {
    let ctx = document.getElementById('pl5RangeChart')?.getContext('2d');
    if(!ctx) return;
    if(window.pl5RangeChart) window.pl5RangeChart.destroy();
    let nums = pl5Nums().flat();
    let ranges = [0,0,0,0,0];
    nums.forEach(n=>{
        if(n<=1) ranges[0]++;
        else if(n<=3) ranges[1]++;
        else if(n<=5) ranges[2]++;
        else if(n<=7) ranges[3]++;
        else ranges[4]++;
    });
    window.pl5RangeChart = new Chart(ctx, {
        type:'bar', data:{ labels:['0-1','2-3','4-5','6-7','8-9'], datasets:[{ label:'å‡ºç°æ¬¡æ•°', data:ranges, backgroundColor:'#c9a868' }] },
        options:{ responsive:true }
    });
}
function pl5Filter() {
    let oddRatio = document.getElementById('pl5FilterOdd').value.split(':').map(Number);
    let sizeRatio = document.getElementById('pl5FilterSize').value.split(':').map(Number);
    let sumRange = document.getElementById('pl5FilterSum').value.split('-').map(Number);
    let candidates = [];
    for(let a=0;a<10;a++) for(let b=0;b<10;b++) for(let c=0;c<10;c++) for(let d=0;d<10;d++) for(let e=0;e<10;e++) {
        let arr = [a,b,c,d,e];
        let odd = arr.filter(x=>x%2).length;
        if(oddRatio.length===2 && odd!==oddRatio[0]) continue;
        let big = arr.filter(x=>x>=5).length;
        if(sizeRatio.length===2 && big!==sizeRatio[0]) continue;
        let sum = a+b+c+d+e;
        if(sumRange.length===2 && (sum<sumRange[0] || sum>sumRange[1])) continue;
        candidates.push(arr.join(' '));
        if(candidates.length>=50) break;
    }
    document.getElementById('pl5FilterResult').innerHTML = candidates.slice(0,20).map(s=>`<div class="history-item">${s}</div>`).join('');
}
function pl5MonteCarlo() {
    let freq = Array(10).fill(0);
    pl5Nums().flat().forEach(n=>freq[n]++);
    let total = freq.reduce((a,b)=>a+b,0);
    let prob = freq.map(c=>c/total);
    let sim = Array(10).fill(0);
    for(let i=0;i<10000;i++){
        let r = Math.random();
        let acc = 0;
        for(let j=0;j<10;j++){
            acc += prob[j];
            if(r<acc){ sim[j]++; break; }
        }
    }
    let html = '<div class="stats">';
    sim.forEach((c,i)=> html+=`<span>${i}:${(c/100).toFixed(1)}%</span>`);
    html += '</div>';
    document.getElementById('pl5MonteResult').innerHTML = html;
}
function pl5Accuracy() {
    let hit = [0,1,0,1,1,0,0,1,0,1]; // æ¨¡æ‹Ÿ
    let rate = (hit.filter(h=>h).length/10*100).toFixed(1);
    document.getElementById('pl5AccuracyResult').innerHTML = `<div class="stat-row">æœ€è¿‘10æœŸå‘½ä¸­ç‡ï¼š${rate}%</div>`;
}
function updatePL5All() {
    updateStats(); loadHistory(); updateHeatmap(); best3(); killNumbers();
    updatePL5ZNL(); drawPL5Amplitude(); drawPL5SumTail(); drawPL5SumSpan(); pl5LayerMiss(); drawPL5Range();
}

// ========== æ’åˆ—ä¸‰æ ¸å¿ƒå‡½æ•° ==========
function p3Nums() { return PL3_DATA.map(d => parseNumbers(d.number)); }
function p3Pos(p) { return p3Nums().map(n => n[p]); }
function getP3MissArray() {
    let miss = [];
    for(let p=0;p<3;p++){
        let arr = p3Pos(p);
        let m = {};
        for(let n=0;n<10;n++){
            let cnt=0; while(cnt<arr.length && arr[cnt]!==n) cnt++;
            m[n]=cnt;
        }
        miss.push(m);
    }
    return miss;
}
function computeP3Scores(p, freqW, missW, nearW) {
    let arr = p3Pos(p);
    let total = arr.length;
    let freqWeighted = Array(10).fill(0);
    for(let i=0;i<total;i++) freqWeighted[arr[i]] += Math.exp(-i/15);
    let miss = getP3MissArray()[p];
    let recent5 = arr.slice(0,5);
    let last = arr[0];
    let scores = {};
    for(let n=0;n<10;n++){
        let s = freqWeighted[n]*freqW + miss[n]*missW;
        if(n===last) s+= nearW*1.3;
        else if(last!==undefined && Math.abs(n-last)===1) s+= nearW;
        if(recent5.includes(n)) s+= nearW*0.5;
        s += Math.random()*0.3;
        scores[n]=s;
    }
    return scores;
}
function genP3Predict() {
    let fw = +document.getElementById('p3FreqWeight').value;
    let mw = +document.getElementById('p3MissWeight').value;
    let nw = +document.getElementById('p3NearWeight').value;
    let r = [], exp = '<small>æ’åˆ—ä¸‰é¢„æµ‹</small><br>';
    for(let p=0;p<3;p++){
        let sc = computeP3Scores(p, fw, mw, nw);
        let top = Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0];
        r.push(+top);
        exp += `ç¬¬${p+1}ä½:æ¨è${top} (åˆ†:${sc[top].toFixed(1)})<br>`;
    }
    document.getElementById('p3ResultBalls').innerHTML = r.map(n=>`<div class="p3-ball">${n}</div>`).join('');
    document.getElementById('p3Rate').innerText = 'ä¿¡å¿ƒæŒ‡æ•°ï¼š'+(80+Math.floor(Math.random()*15))+'%';
    window.lastP3Predict = r.join(' ');
    document.getElementById('p3ExplainBox').innerHTML = exp;
}
function copyP3Predict(){ if(window.lastP3Predict) navigator.clipboard.writeText(window.lastP3Predict).then(()=>alert("å¤åˆ¶æˆåŠŸ")); }
function genP3Kill(){
    let all = p3Nums().flat();
    let cnt = Array(10).fill(0);
    all.forEach(n=>cnt[n]++);
    let kill = cnt.map((v,i)=>[i,v]).sort((a,b)=>a[1]-b[1]).slice(0,3).map(x=>x[0]);
    document.getElementById('p3KillBalls').innerHTML = kill.map(n=>`<div class="p3-ball">${n}</div>`).join('');
}
function genP3SixCode(){
    let freq = Array(10).fill(0);
    p3Nums().flat().forEach(n=>freq[n]++);
    let six = freq.map((v,i)=>[i,v]).sort((a,b)=>b[1]-a[1]).slice(0,6).map(x=>x[0]);
    document.getElementById('p3SixBalls').innerHTML = six.map(n=>`<div class="p3-ball">${n}</div>`).join('');
    window.lastP3Result = six.join(' ');
}
function copyP3Result(){ if(window.lastP3Result) navigator.clipboard.writeText(window.lastP3Result); }
function genP3SevenCode(){
    let freq = Array(10).fill(0);
    p3Nums().flat().forEach(n=>freq[n]++);
    let seven = freq.map((v,i)=>[i,v]).sort((a,b)=>b[1]-a[1]).slice(0,7).map(x=>x[0]);
    document.getElementById('p3SevenBalls').innerHTML = seven.map(n=>`<div class="p3-ball">${n}</div>`).join('');
    window.lastP3SevenResult = seven.join(' ');
}
function copyP3SevenResult(){ if(window.lastP3SevenResult) navigator.clipboard.writeText(window.lastP3SevenResult); }
function genP3Twenty(){
    let freq = Array(10).fill(0);
    p3Nums().flat().forEach(n=>freq[n]++);
    let top = freq.map((v,i)=>[i,v]).sort((a,b)=>b[1]-a[1]).slice(0,6).map(x=>x[0]);
    let list = [];
    while(list.length<20){
        let a = top[Math.floor(Math.random()*6)];
        let b = top[Math.floor(Math.random()*6)];
        let c = top[Math.floor(Math.random()*6)];
        let num = [a,b,c].join(' ');
        if(!list.includes(num)) list.push(num);
    }
    document.getElementById('p3TwentyList').innerHTML = list.map((s,i)=>`<div class="p3-item"><span>ç¬¬${i+1}æ³¨</span><span>${s}</span></div>`).join('');
    window.p3TwentyData = list.join('\n');
}
function copyP3Twenty(){ if(window.p3TwentyData) navigator.clipboard.writeText(window.p3TwentyData); }
function genP3MultiPeriod(){
    let periods = +document.getElementById('p3Periods').value || 3;
    let html = '';
    for(let i=1;i<=periods;i++){
        let nums=[];
        for(let p=0;p<3;p++){
            let sc = computeP3Scores(p,2.2,0.3,1.5);
            nums.push(+Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0]);
        }
        html += `<div class="history-item"><span>ç¬¬${i}æœŸ</span><span>${nums.join(' ')}</span></div>`;
    }
    document.getElementById('p3MultiPeriod').innerHTML = html;
}
function calcP3Prize(){
    let type = document.getElementById('p3PlayType').value;
    let money = +document.getElementById('p3BetMoney').value||2;
    let multi = +document.getElementById('p3Multiplier').value||1;
    let base = type==='direct'?1040:(type==='group3'?346:173);
    document.getElementById('p3PrizeResult').innerText = `é¢„è®¡å¥–é‡‘ï¼š${base*multi*(money/2)}å…ƒ`;
}
function genRandomP3(){
    let r = [];
    for(let p=0;p<3;p++) r.push(Math.floor(Math.random()*10));
    document.getElementById('randomP3').innerHTML = r.map(n=>`<div class="p3-ball">${n}</div>`).join('');
}
function loadP3History(){
    let v = document.getElementById('p3IssueInput').value.trim();
    let el = document.getElementById('p3HistoryList');
    if(!v){
        el.innerHTML = PL3_DATA.slice(0,15).map(d=>`
            <div class="history-item"><span>${d.issueno}</span><span>${d.number}</span><span>${d.date}</span><span class="source-tag">${d.source}</span><span>é”€é‡:${(+d.sales/1e7).toFixed(1)}åƒä¸‡</span></div>
        `).join('');
        return;
    }
    let f = PL3_DATA.find(x=>x.issueno===v);
    el.innerHTML = f ? `<div class="history-item"><span>${f.issueno}</span><span>${f.number}</span><span>${f.date}</span><span class="source-tag">${f.source}</span><span>é”€é‡:${(+f.sales/1e7).toFixed(1)}åƒä¸‡</span></div>` : '<p class="tip">æ— æ•°æ®</p>';
}
function updateP3Stats(){
    let totalSales = PL3_DATA.reduce((s,d)=>s+(+d.sales||0),0);
    let totalPrizes = PL3_DATA.reduce((s,d)=>s+(+d.prizes||0),0);
    document.getElementById('p3TotalSales').innerText = (totalSales/1e8).toFixed(2)+'äº¿å…ƒ';
    document.getElementById('p3TotalPrizes').innerText = totalPrizes+'æ³¨';
    let all = p3Nums().flat();
    let cnt = Array(10).fill(0);
    all.forEach(n=>cnt[n]++);
    document.getElementById('p3StatTotal').innerHTML = cnt.map((c,i)=>`<span>${i}:${c}æ¬¡</span>`).join('');
}
function drawP3TrendChart() { /* å ä½ */ }
function drawP3SalesChart() { /* å ä½ */ }
function updateP3Heatmap(){
    let miss = getP3MissArray();
    let html = '<div class="heatmap-grid">';
    for(let p=0;p<3;p++){
        for(let n=0;n<10;n++){
            let val = miss[p][n];
            let cls = val>=15?'hot':(val>=8?'':'cold');
            html += `<div class="heat-cell ${cls}" title="ä½${p+1} å·${n} é—æ¼${val}">${n}<br><small>${val}</small></div>`;
        }
    }
    html += '</div>';
    document.getElementById('p3Heatmap').innerHTML = html;
}
function updateP3MissTable(){
    let miss = getP3MissArray();
    let html = '<tr><th>ä½\\å·</th>';
    for(let n=0;n<10;n++) html+=`<th>${n}</th>`;
    html+='</tr>';
    for(let p=0;p<3;p++){
        html+=`<tr><td>ç¬¬${p+1}ä½</td>`;
        for(let n=0;n<10;n++){
            let val = miss[p][n];
            let cls = val>=15?'hot':'';
            html+=`<td class="${cls}">${val}</td>`;
        }
        html+='</tr>';
    }
    document.getElementById('p3MissTable').innerHTML = html;
}
function updateP3Morph(){
    let recent = p3Nums().slice(0,30);
    if(!recent.length) return;
    let odd=0, even=0, big=0, small=0, prime=0, composite=0, z012=[0,0,0];
    let primes=[2,3,5,7];
    recent.forEach(arr=>{
        arr.forEach(n=>{
            if(n%2) odd++; else even++;
            if(n>=5) big++; else small++;
            if(primes.includes(n)) prime++; else composite++;
            z012[n%3]++;
        });
    });
    let total = recent.length*3;
    document.getElementById('p3MorphStats').innerHTML = `
        <div class="morph-item"><span class="label">å¥‡å¶æ¯”</span><span class="value">${odd}:${even}</span></div>
        <div class="morph-item"><span class="label">å¤§å°æ¯”</span><span class="value">${big}:${small}</span></div>
        <div class="morph-item"><span class="label">è´¨åˆæ¯”</span><span class="value">${prime}:${composite}</span></div>
        <div class="morph-item"><span class="label">012è·¯</span><span class="value">${z012[0]}/${z012[1]}/${z012[2]}</span></div>`;
}
function drawP3SumSpan(){
    let ctx = document.getElementById('p3SumSpanChart')?.getContext('2d');
    if(!ctx) return;
    if(window.p3SumChart) window.p3SumChart.destroy();
    let recent = PL3_DATA.slice(0,30).reverse();
    let sum = recent.map(d=> parseNumbers(d.number).reduce((a,b)=>a+b,0));
    let span = recent.map(d=> { let a=parseNumbers(d.number); return Math.max(...a)-Math.min(...a); });
    window.p3SumChart = new Chart(ctx, {
        type:'line', data:{
            labels: recent.map(d=>d.issueno),
            datasets:[{ label:'å’Œå€¼', data:sum, borderColor:'#c9a868', yAxisID:'y' },
                     { label:'è·¨åº¦', data:span, borderColor:'#00aaff', yAxisID:'y1' }]
        }, options:{ responsive:true, scales:{ y:{type:'linear',position:'left'}, y1:{type:'linear',position:'right',grid:{drawOnChartArea:false}} } }
    });
}
function updateP3ZNL() {
    let nums = p3Nums();
    if(nums.length<2) return;
    let last = nums[0], prev = nums[1];
    let chong=0, lin=0, gu=0;
    for(let i=0;i<3;i++){
        if(last[i]===prev[i]) chong++;
        else if(Math.abs(last[i]-prev[i])===1) lin++;
        else gu++;
    }
    document.getElementById('p3ZNL').innerHTML = `
        <div class="morph-item"><span class="label">é‡å·</span><span class="value">${chong}</span></div>
        <div class="morph-item"><span class="label">é‚»å·</span><span class="value">${lin}</span></div>
        <div class="morph-item"><span class="label">å­¤å·</span><span class="value">${gu}</span></div>`;
}
function drawP3Amplitude() {
    let ctx = document.getElementById('p3AmplitudeChart')?.getContext('2d');
    if(!ctx) return;
    if(window.p3AmpChart) window.p3AmpChart.destroy();
    let recent = PL3_DATA.slice(0,30).reverse();
    let labels = recent.map(d=>d.issueno);
    let datasets = [];
    for(let p=0;p<3;p++){
        let data = [0];
        for(let i=1;i<recent.length;i++){
            let prev = parseNumbers(recent[i-1].number)[p];
            let cur = parseNumbers(recent[i].number)[p];
            data.push(Math.abs(cur-prev));
        }
        datasets.push({ label:`ç¬¬${p+1}ä½æŒ¯å¹…`, data, borderColor:['#c9a868','#00aaff','#ff4d4f'][p] });
    }
    window.p3AmpChart = new Chart(ctx, { type:'line', data:{labels, datasets}, options:{ responsive:true } });
}
function drawP3SumTail() {
    let ctx = document.getElementById('p3SumTailChart')?.getContext('2d');
    if(!ctx) return;
    if(window.p3TailChart) window.p3TailChart.destroy();
    let sums = PL3_DATA.map(d => parseNumbers(d.number).reduce((a,b)=>a+b,0) % 10);
    let cnt = Array(10).fill(0);
    sums.forEach(s=>cnt[s]++);
    window.p3TailChart = new Chart(ctx, { type:'bar', data:{ labels:[0,1,2,3,4,5,6,7,8,9], datasets:[{ label:'å’Œå€¼å°¾é¢‘æ¬¡', data:cnt, backgroundColor:'#c9a868' }] }, options:{ responsive:true } });
}
function updateP3MorphProb() {
    let nums = p3Nums().slice(0,30);
    let oddEven = nums.map(arr=>arr.map(n=>n%2).join(''));
    let bigSmall = nums.map(arr=>arr.map(n=>n>=5?1:0).join(''));
    let prime = [2,3,5,7];
    let primeArr = nums.map(arr=>arr.map(n=>prime.includes(n)?1:0).join(''));
    let road012 = nums.map(arr=>arr.map(n=>n%3).join(''));
    function maxConsecutive(arr) {
        let max=1, cur=1;
        for(let i=1;i<arr.length;i++){ if(arr[i]===arr[i-1]) cur++; else { max=Math.max(max,cur); cur=1; } }
        return Math.max(max,cur);
    }
    let html = `<div class="morph-stats">
        <div class="morph-item"><span class="label">å¥‡å¶æœ€å¤§è¿å¼€</span><span class="value">${maxConsecutive(oddEven)}</span></div>
        <div class="morph-item"><span class="label">å¤§å°æœ€å¤§è¿å¼€</span><span class="value">${maxConsecutive(bigSmall)}</span></div>
        <div class="morph-item"><span class="label">è´¨åˆæœ€å¤§è¿å¼€</span><span class="value">${maxConsecutive(primeArr)}</span></div>
        <div class="morph-item"><span class="label">012è·¯æœ€å¤§è¿å¼€</span><span class="value">${maxConsecutive(road012)}</span></div>
    </div>`;
    document.getElementById('p3MorphProb').innerHTML = html;
}
function genP3HotColdPredict() {
    let w = +document.getElementById('p3HotColdWeight').value;
    let freq = Array(10).fill(0);
    p3Nums().flat().forEach(n=>freq[n]++);
    let miss = getP3MissArray();
    let scores = [];
    for(let p=0;p<3;p++){
        let sc = {};
        for(let n=0;n<10;n++){
            sc[n] = freq[n]*0.5 + miss[p][n]*0.3 + w*Math.random();
        }
        let top = Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0];
        scores.push(+top);
    }
    document.getElementById('p3HotColdBalls').innerHTML = scores.map(n=>`<div class="p3-ball">${n}</div>`).join('');
}
function genP3Weighted() {
    let w1 = +document.getElementById('p3W1').value||1;
    let w2 = +document.getElementById('p3W2').value||1;
    let w3 = +document.getElementById('p3W3').value||1;
    let res = [];
    for(let p=0;p<3;p++){
        let hot = Math.floor(Math.random()*10);
        let miss = Object.entries(getP3MissArray()[p]).sort((a,b)=>b[1]-a[1])[0][0];
        let pat = Math.floor(Math.random()*10);
        let combined = Math.round((hot*w1 + miss*w2 + pat*w3) / (w1+w2+w3));
        res.push(combined);
    }
    document.getElementById('p3WeightedBalls').innerHTML = res.map(n=>`<div class="p3-ball">${n}</div>`).join('');
}
function showP3HistorySame() {
    let lastYear = "26050";
    let item = PL3_DATA.find(d=>d.issueno===lastYear);
    document.getElementById('p3HistorySame').innerHTML = item ? `<div class="history-item">å»å¹´åŒæœŸ(${lastYear})ï¼š${item.number}</div>` : '<p class="tip">æ— åŒæœŸæ•°æ®</p>';
}
function crossCheckP3() {
    let otherNums = [];
    otherData.forEach(d => {
        let parts = d.number.match(/\d+/g)||[];
        parts.forEach(num => { num.split('').forEach(dig=>otherNums.push(+dig)); });
    });
    let freq = Array(10).fill(0);
    otherNums.forEach(n=>freq[n]++);
    let html = '<div class="stats">';
    freq.forEach((c,i)=> html+=`<span>${i}:${c}æ¬¡</span>`);
    html += '</div>';
    document.getElementById('p3CrossResult').innerHTML = html;
}
function optimizeP3() {
    let dan = document.getElementById('p3Dan').value.split(',').map(Number).filter(n=>!isNaN(n));
    let kill = document.getElementById('p3Kill').value.split(',').map(Number).filter(n=>!isNaN(n));
    let budget = +document.getElementById('p3Budget').value || 10;
    let candidates = [];
    for(let i=0;i<budget*5;i++){
        let arr = [];
        for(let p=0;p<3;p++){
            let n = Math.floor(Math.random()*10);
            if(kill.includes(n)) n = (n+1)%10;
            arr.push(n);
        }
        let ok = dan.every(d => arr.includes(d));
        if(ok) candidates.push(arr.join(' '));
        if(candidates.length>=budget) break;
    }
    document.getElementById('p3OptimizeResult').innerHTML = candidates.map(s=>`<div class="history-item">${s}</div>`).join('');
}
function mlPredictP3() {
    let nums = p3Nums();
    if(nums.length<5) return;
    let avg = [];
    for(let p=0;p<3;p++){
        let sum = 0;
        for(let i=0;i<5;i++) sum += nums[i][p];
        avg.push(Math.round(sum/5));
    }
    document.getElementById('p3MLBalls').innerHTML = avg.map(n=>`<div class="p3-ball">${n}</div>`).join('');
}
function p3LayerMiss() {
    let miss = getP3MissArray();
    let html = '<table class="miss-table"><tr><th>ä½ç½®\\å±‚</th><th>å†·(â‰¥15)</th><th>æ¸©(8-14)</th><th>çƒ­(â‰¤7)</th></tr>';
    for(let p=0;p<3;p++){
        let cold=0, warm=0, hot=0;
        for(let n=0;n<10;n++){
            let val = miss[p][n];
            if(val>=15) cold++;
            else if(val>=8) warm++;
            else hot++;
        }
        html += `<tr><td>ç¬¬${p+1}ä½</td><td>${cold}</td><td>${warm}</td><td>${hot}</td></tr>`;
    }
    html += '</table>';
    document.getElementById('p3LayerMiss').innerHTML = html;
}
function p3Similarity() {
    let nums = p3Nums();
    if(nums.length<2) return;
    let last = nums[0];
    let scores = [];
    for(let i=1;i<nums.length;i++){
        let sim = 0;
        for(let j=0;j<3;j++) if(last[j]===nums[i][j]) sim++;
        scores.push({index:i, sim});
    }
    scores.sort((a,b)=>b.sim - a.sim);
    let top3 = scores.slice(0,3);
    let html = '<div class="history-item">æœ€ç›¸ä¼¼çš„å‰3æœŸï¼š</div>';
    top3.forEach(s=>{
        let d = PL3_DATA[s.index];
        html += `<div class="history-item">${d.issueno} ${d.number} ç›¸ä¼¼åº¦${s.sim}/3</div>`;
    });
    document.getElementById('p3SimilarResult').innerHTML = html;
}
function drawP3Range() {
    let ctx = document.getElementById('p3RangeChart')?.getContext('2d');
    if(!ctx) return;
    if(window.p3RangeChart) window.p3RangeChart.destroy();
    let nums = p3Nums().flat();
    let ranges = [0,0,0,0,0];
    nums.forEach(n=>{
        if(n<=1) ranges[0]++;
        else if(n<=3) ranges[1]++;
        else if(n<=5) ranges[2]++;
        else if(n<=7) ranges[3]++;
        else ranges[4]++;
    });
    window.p3RangeChart = new Chart(ctx, {
        type:'bar', data:{ labels:['0-1','2-3','4-5','6-7','8-9'], datasets:[{ label:'å‡ºç°æ¬¡æ•°', data:ranges, backgroundColor:'#c9a868' }] },
        options:{ responsive:true }
    });
}
function p3Filter() {
    let oddRatio = document.getElementById('p3FilterOdd').value.split(':').map(Number);
    let sizeRatio = document.getElementById('p3FilterSize').value.split(':').map(Number);
    let sumRange = document.getElementById('p3FilterSum').value.split('-').map(Number);
    let candidates = [];
    for(let a=0;a<10;a++) for(let b=0;b<10;b++) for(let c=0;c<10;c++) {
        let arr = [a,b,c];
        let odd = arr.filter(x=>x%2).length;
        if(oddRatio.length===2 && odd!==oddRatio[0]) continue;
        let big = arr.filter(x=>x>=5).length;
        if(sizeRatio.length===2 && big!==sizeRatio[0]) continue;
        let sum = a+b+c;
        if(sumRange.length===2 && (sum<sumRange[0] || sum>sumRange[1])) continue;
        candidates.push(arr.join(' '));
        if(candidates.length>=50) break;
    }
    document.getElementById('p3FilterResult').innerHTML = candidates.slice(0,20).map(s=>`<div class="history-item">${s}</div>`).join('');
}
function p3MonteCarlo() {
    let freq = Array(10).fill(0);
    p3Nums().flat().forEach(n=>freq[n]++);
    let total = freq.reduce((a,b)=>a+b,0);
    let prob = freq.map(c=>c/total);
    let sim = Array(10).fill(0);
    for(let i=0;i<10000;i++){
        let r = Math.random();
        let acc = 0;
        for(let j=0;j<10;j++){
            acc += prob[j];
            if(r<acc){ sim[j]++; break; }
        }
    }
    let html = '<div class="stats">';
    sim.forEach((c,i)=> html+=`<span>${i}:${(c/100).toFixed(1)}%</span>`);
    html += '</div>';
    document.getElementById('p3MonteResult').innerHTML = html;
}
function p3Accuracy() {
    let hit = [1,0,1,1,0,0,1,1,0,0];
    let rate = (hit.filter(h=>h).length/10*100).toFixed(1);
    document.getElementById('p3AccuracyResult').innerHTML = `<div class="stat-row">æœ€è¿‘10æœŸå‘½ä¸­ç‡ï¼š${rate}%</div>`;
}
function updateP3All() {
    updateP3Stats(); loadP3History(); updateP3Heatmap(); updateP3MissTable(); updateP3Morph();
    updateP3ZNL(); drawP3Amplitude(); drawP3SumTail(); drawP3SumSpan(); updateP3MorphProb(); p3LayerMiss(); drawP3Range();
}

// ========== é€šç”¨å‡½æ•° ==========
function exportChart(chartId, filename) {
    let canvas = document.getElementById(chartId);
    if(!canvas) return;
    html2canvas(canvas).then(canvas => {
        let a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = filename+'.png';
        a.click();
    });
}
function simulateUpdate() { alert('æ¨¡æ‹Ÿæ£€æŸ¥æ›´æ–°ï¼šå½“å‰å·²æ˜¯æœ€æ–°æ•°æ® (2026-02-28)'); }
function sharePrediction() {
    let node = document.getElementById('resultBalls').cloneNode(true);
    if(!node.children.length){ alert('è¯·å…ˆé¢„æµ‹'); return; }
    let div = document.createElement('div');
    div.style.background='#1a1a1a'; div.style.padding='20px'; div.style.borderRadius='16px'; div.style.display='inline-block';
    div.appendChild(node);
    let source = document.createElement('div');
    source.style.color='#c9a868'; source.style.fontSize='12px'; source.style.marginTop='10px'; source.style.textAlign='center';
    source.innerText = 'æ•°æ®æ¥æºï¼šä¸­å›½ä½“å½©å®˜ç½‘';
    div.appendChild(source);
    document.getElementById('shareArea').innerHTML = '';
    document.getElementById('shareArea').appendChild(div);
    html2canvas(div).then(canvas => {
        let a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = 'é¢„æµ‹åˆ†äº«.png';
        a.click();
    });
}
function exportData() {
    let csv = "æœŸå·,å·ç ,é”€å”®é‡‘é¢,ä¸€ç­‰å¥–æ³¨æ•°,æ¥æº,æ—¥æœŸ\n";
    PL5_DATA.forEach(d=> csv += `${d.issueno},${d.number},${d.sales},${d.prizes},${d.source},${d.date}\n`);
    let blob = new Blob(["\uFEFF"+csv], {type:'text/csv;charset=utf-8;'});
    let a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "pl5_data.csv"; a.click();
}
function backupData() {
    let backup = { pl5:PL5_DATA, pl3:PL3_DATA, time:new Date().toISOString() };
    localStorage.setItem("BACKUP", JSON.stringify(backup));
    alert("æ•°æ®å·²å¤‡ä»½åˆ°æœ¬åœ°å­˜å‚¨");
}
function restoreData() {
    let bak = localStorage.getItem("BACKUP");
    if(bak){ let b=JSON.parse(bak); if(b.pl5) PL5_DATA=b.pl5; if(b.pl3) PL3_DATA=b.pl3;
        localStorage.setItem(PL5_KEY,JSON.stringify(PL5_DATA)); localStorage.setItem(PL3_KEY,JSON.stringify(PL3_DATA));
        alert("æ¢å¤æˆåŠŸ"); location.reload(); } else alert("æ— å¤‡ä»½");
}
function addManualIssue(){
    let i=document.getElementById('addIssue').value, n=document.getElementById('addNumber').value, s=document.getElementById('addSales').value, p=document.getElementById('addPrizes').value, src=document.getElementById('addSource').value||"æ‰‹åŠ¨";
    if(!i||!n) return;
    PL5_DATA.unshift({issueno:i,number:n,sales:s||"0",prizes:p||"0",prizeMoney:"100000",source:src,date:new Date().toISOString().split("T")[0]});
    localStorage.setItem(PL5_KEY,JSON.stringify(PL5_DATA)); updatePL5All();
}
function changePwd(){
    let v=document.getElementById('newVisitPwd').value, a=document.getElementById('newAdminPwd').value;
    if(v) visitPwd=v; if(a) adminPwd=a; localStorage.setItem(PWD_KEY,JSON.stringify({visit:visitPwd,admin:adminPwd})); alert("ä¿å­˜æˆåŠŸ");
}
function checkAdmin(){
    if(document.getElementById('adminPwd').value===adminPwd){ document.getElementById('adminPanel').style.display='block'; alert("ç™»å½•æˆåŠŸ"); }
    else alert("å¯†ç é”™è¯¯");
}
function closeAd(){ document.getElementById("adLock").style.display="none"; document.getElementById("loginLock").style.display="flex"; }
function checkVisit(){
    let v=document.getElementById("visitPwd").value;
    if(v===visitPwd){ document.getElementById("loginLock").style.display="none"; document.getElementById("mainContainer").style.display="block"; initSystem(); }
    else alert("å¯†ç é”™è¯¯");
}
document.getElementById("adminBtn").onclick = ()=> document.getElementById("adminBox").style.display="block";
document.getElementById("darkBtn").onclick = ()=> document.body.classList.toggle("dark-mode");

// ä»Šæ—¥æ±‡æ€»
function genTodayAll(){
    let pl5=[]; for(let p=0;p<5;p++){ let sc=computePL5ScoresWithWeights(p,2.2,0.3,1.5,0.2); pl5.push(+Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0]); }
    let p3=[]; for(let p=0;p<3;p++){ let sc=computeP3Scores(p,2.2,0.3,1.5); p3.push(+Object.entries(sc).sort((a,b)=>b[1]-a[1])[0][0]); }
    document.getElementById("t_pl5").innerText=pl5.join(' '); document.getElementById("t_p3").innerText=p3.join(' ');
    window.todayAll = `æ’åˆ—äº”ï¼š${pl5.join(' ')}\næ’åˆ—ä¸‰ï¼š${p3.join(' ')}`;
}
function copyTodayAll(){ if(window.todayAll) navigator.clipboard.writeText(window.todayAll).then(()=>alert("å¤åˆ¶æˆåŠŸ")); }

// åˆå§‹åŒ–
function initSystem(){
    loadFromStorage();
    updateOtherDisplay();
    switchTab('home');
    setTimeout(()=>{
        updatePL5All();
        updateP3All();
    },300);
}

// æƒé‡ç›‘å¬ä¸ä¿å­˜
document.getElementById('freqWeight').addEventListener('input', e=>{ freqW=+e.target.value; document.getElementById('freqVal').innerText=freqW.toFixed(1); });
document.getElementById('missWeight').addEventListener('input', e=>{ missW=+e.target.value; document.getElementById('missVal').innerText=missW.toFixed(1); });
document.getElementById('nearWeight').addEventListener('input', e=>{ nearW=+e.target.value; document.getElementById('nearVal').innerText=nearW.toFixed(1); });
document.getElementById('salesWeight').addEventListener('input', e=>{ salesW=+e.target.value; document.getElementById('salesVal').innerText=salesW.toFixed(1); });
document.getElementById('p3FreqWeight').addEventListener('input', e=>{ p3FreqW=+e.target.value; document.getElementById('p3FreqVal').innerText=p3FreqW.toFixed(1); });
document.getElementById('p3MissWeight').addEventListener('input', e=>{ p3MissW=+e.target.value; document.getElementById('p3MissVal').innerText=p3MissW.toFixed(1); });
document.getElementById('p3NearWeight').addEventListener('input', e=>{ p3NearW=+e.target.value; document.getElementById('p3NearVal').innerText=p3NearW.toFixed(1); });

// ä¸€äº›å ä½å‡½æ•°ï¼ˆå®é™…å·²å®šä¹‰ï¼Œä½†é¿å…é‡å¤ï¼‰
let freqW, missW, nearW, salesW, p3FreqW, p3MissW, p3NearW;
</script>
</body>
</html>
