<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé¢„æµ‹ç³»ç»Ÿ Â· æ——èˆ°å¢å¼ºç‰ˆ</title>
    <!-- Chart.js è½»é‡å›¾è¡¨ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- html2canvas ç”¨äºåˆ†äº«å›¾ç‰‡ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            -webkit-user-select: none;
            user-select: none;
        }
        :root {
            --bg: #0c0c0c;
            --card: #1a1a1a;
            --gold: #c9a868;
            --blue: #00aaff;
            --light-bg: #222;
            --text: #f0f0f0;
            --tip: #888;
            --radius: 16px;
            --shadow: 0 8px 24px rgba(0,0,0,0.3);
            --transition: all 0.3s ease;
        }
        body {
            background: var(--bg);
            color: var(--text);
            transition: var(--transition);
            padding-bottom: 40px;
            overflow-x: hidden;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .top-nav {
            background: var(--card);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 16px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            white-space: nowrap;
            box-shadow: var(--shadow);
        }
        .nav-item {
            flex: 1;
            min-width: 70px;
            padding: 10px 8px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            background: var(--light-bg);
            color: #ccc;
            transition: var(--transition);
        }
        .nav-item.active {
            background: var(--gold);
            color: #000;
            font-weight: bold;
        }
        .navbar {
            background: var(--card);
            border-radius: var(--radius);
            padding: 16px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: relative; z-index: 10;
        }
        .navbar h1 {
            font-size: 20px;
            color: var(--gold);
            font-weight: 700;
        }
        .nav-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .btn {
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background: var(--gold);
            color: #000;
        }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
        }
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: none;
        }
        .card.show {
            display: block;
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input, select {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid #333;
            background: #222;
            color: var(--text);
            margin-bottom: 12px;
            font-size: 15px;
            -webkit-user-select: auto;
            user-select: auto;
        }
        input:focus {
            outline: none;
            border-color: var(--gold);
        }
        .countdown {
            font-size: 18px;
            font-weight: 700;
            color: var(--blue);
            text-align: center;
            padding: 12px;
            background: var(--light-bg);
            border-radius: 12px;
        }
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .stats span {
            padding: 6px 10px;
            background: var(--light-bg);
            color: var(--gold);
            border-radius: 8px;
            font-size: 13px;
        }
        .balls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        .ball {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c9a868, #a08040);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
        }
        .num-ball {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--blue);
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .grid5 {
            display: grid;
            grid-template-columns: repeat(5,1fr);
            gap: 10px;
        }
        .item {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 16px 10px;
            text-align: center;
            font-size: 14px;
            color: var(--gold);
        }
        .item strong {
            font-size: 16px;
        }
        .chart-box {
            overflow-x: auto;
            border-radius: 12px;
        }
        .trend-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .trend-table th {
            background: var(--light-bg);
            color: var(--gold);
            padding: 10px;
            text-align: center;
        }
        .trend-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px dashed #333;
            font-size: 15px;
        }
        .p3-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        .p3-ball {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            background: var(--blue);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
            font-weight: 700;
        }
        .p3-list {
            max-height: 380px;
            overflow-y: auto;
            margin-top: 12px;
        }
        .p3-item {
            padding: 10px 14px;
            background: var(--light-bg);
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .lotto-box, .ssq-box {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        .lotto-front, .lotto-back, .ssq-red, .ssq-blue {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
        }
        .lotto-front { background: linear-gradient(135deg, #1677ff, #0050b3); color: #fff; }
        .lotto-back { background: linear-gradient(135deg, #ff4d4f, #cf1322); color: #fff; }
        .ssq-red { background: linear-gradient(135deg, #ff4d4f, #cf1322); color: #fff; }
        .ssq-blue { background: linear-gradient(135deg, #1677ff, #0050b3); color: #fff; }
        .tip {
            font-size: 12px;
            color: var(--tip);
            text-align: center;
            margin-top: 8px;
        }
        .rate {
            color: var(--blue);
            font-weight: 600;
            font-size: 15px;
            text-align: center;
            margin-top: 8px;
        }
        .loading {
            text-align: center;
            padding: 10px;
            color: var(--gold);
            font-size: 14px;
            display: none;
        }
        .login-lock, .ad-lock {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0c0c0c;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .login-box, .ad-box {
            width: 90%;
            max-width: 400px;
            background: var(--card);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 12px 32px rgba(0,0,0,0.4);
            text-align: center;
        }
        .vip-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }
        .vip-box {
            width: 90%;
            max-width: 400px;
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }
        .vip-title {
            font-size: 22px;
            color: var(--gold);
            margin-bottom: 10px;
            font-weight: bold;
        }
        .summary-card {
            background: var(--card);
            border-left: 4px solid var(--gold);
        }
        .admin-box { display: none; }
        #adminPanel { display: none; margin-top: 16px; }
        .copyright {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 30px;
            line-height: 1.5;
        }

        /* æ–°å¢æ ·å¼ */
        .canvas-container {
            width: 100%;
            height: 200px;
            margin: 10px 0;
            background: #111;
            border-radius: 8px;
            padding: 5px;
        }
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            margin: 10px 0;
        }
        .heat-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 4px;
            background: #2a2a2a;
            color: #ccc;
        }
        .heat-cell.hot { background: #c9a868; color: #000; }
        .heat-cell.cold { background: #3a3a3a; color: #aaa; }
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }
        .slider-group label {
            width: 80px;
            font-size: 14px;
        }
        .slider-group input {
            flex: 1;
            margin: 0;
        }
        .slider-group span {
            width: 40px;
            text-align: right;
        }
        .explain-box {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 13px;
            line-height: 1.6;
        }
        .share-btn {
            background: #00aaff;
            color: #fff;
            border: none;
        }
        .feature-badge {
            display: inline-block;
            background: var(--blue);
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
        }
    </style>
</head>
<body>

<div class="ad-lock" id="adLock">
    <div class="ad-box">
        <h2>ğŸ¯ AIé¢„æµ‹ç³»ç»Ÿ Â· æ——èˆ°å¢å¼ºç‰ˆ</h2>
        <p style="margin-bottom:20px;line-height:1.6;">500æœŸå¤§æ•°æ® | å¤šå› å­åŠ æƒ | å¯è§†åŒ–åˆ†æ | æ™ºèƒ½äº¤äº’</p>
        <button class="btn btn-primary" style="width:100%" onclick="closeAd()">ç«‹å³è¿›å…¥</button>
        <p class="tip">æ•°æ®ä»…ä¾›å‚è€ƒ Â· ç†æ€§åˆ†æ</p>
    </div>
</div>

<div class="login-lock" id="loginLock" style="display:none;">
    <div class="login-box">
        <h2>ä¼šå‘˜éªŒè¯</h2>
        <input type="password" id="visitPwd" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ">
        <button class="btn btn-primary" style="width:100%" onclick="checkVisit()">éªŒè¯è¿›å…¥</button>
        <p class="tip">å¯†ç ï¼š888888</p>
    </div>
</div>

<div id="mainContainer" style="display:none;">
    <div class="container">
        <div class="navbar">
            <h1>ğŸ¯ AIé¢„æµ‹ç³»ç»Ÿ Â· å¢å¼ºç‰ˆ</h1>
            <div class="nav-buttons">
                <button class="btn btn-outline" id="adminBtn">ç®¡ç†</button>
                <button class="btn btn-outline" id="darkBtn">æ·±è‰²</button>
            </div>
        </div>

        <div class="top-nav">
            <div class="nav-item active" data-tab="home">ğŸ  é¦–é¡µ</div>
            <div class="nav-item" data-tab="pl5">âš½ æ’åˆ—äº”</div>
            <div class="nav-item" data-tab="p3">ğŸ¯ æ’åˆ—ä¸‰</div>
            <div class="nav-item" data-tab="lotto">ğŸ° å¤§ä¹é€</div>
            <div class="nav-item" data-tab="ssq">ğŸ”´ åŒè‰²çƒ</div>
            <div class="nav-item" data-tab="summary">ğŸ“‹ ä»Šæ—¥æ±‡æ€»</div>
        </div>

        <!-- é¦–é¡µ -->
        <div class="card show" data-module="home">
            <div class="card-title"><i>ğŸ </i> ç³»ç»Ÿé¦–é¡µ <span class="feature-badge">500æœŸå†å²</span></div>
            <div style="line-height:1.8; font-size:15px;">
                <p>âœ… æ’åˆ—äº”ï¼šAIé¢„æµ‹ã€èµ°åŠ¿ã€ä¸‰èƒ†ã€æ€å·ã€ç²¾é€‰</p>
                <p>âœ… æ’åˆ—ä¸‰ï¼š6ç ã€7ç ã€20æ³¨æ¨è</p>
                <p>âœ… å¤§ä¹é€/åŒè‰²çƒï¼šåŸºäºå†å²æ•°æ®å¤šå› å­è¯„åˆ†</p>
                <p>âœ… ğŸ“ˆ æ–°å¢èµ°åŠ¿æŠ˜çº¿å›¾ã€é—æ¼çƒ­åŠ›å›¾ã€å°¾æ•°åˆ†æ</p>
                <p>âœ… âš™ï¸ è‡ªå®šä¹‰æƒé‡ã€å¤šæœŸé¢„æµ‹ã€å·ç è§£é‡Šå™¨</p>
                <p>âœ… ğŸ§® å¥–é‡‘è®¡ç®—å™¨ã€èµ°åŠ¿ç”»çº¿ã€åˆ†äº«å›¾ç‰‡</p>
                <p>âœ… ğŸ“Š 500æœŸçœŸå®æ¨¡æ‹Ÿæ•°æ®ï¼Œå†·çƒ­äº¤æ›¿æ›´è‡ªç„¶</p>
                <p style="color:var(--blue);">ğŸ‘‡ ç‚¹å‡»é¡¶éƒ¨æ ‡ç­¾å¼€å§‹ä½“éªŒ</p>
            </div>
        </div>

        <!-- æ’åˆ—äº”æ¨¡å— (æ–°å¢åŠŸèƒ½éƒ½é›†æˆåœ¨æ­¤) -->
        <div class="card" data-module="pl5">
            <div class="card-title"><i>â°</i> å¼€å¥–å€’è®¡æ—¶</div>
            <div class="countdown" id="countdown"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“Š</i> å†å²èµ°åŠ¿ç»Ÿè®¡</div>
            <div class="stats" id="statTotal"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“œ</i> å†å²å¼€å¥– <span class="feature-badge">500æœŸ</span></div>
            <input placeholder="è¾“å…¥æœŸå·æŸ¥è¯¢" id="issueInput">
            <button class="btn btn-primary" onclick="loadHistory()">æŸ¥è¯¢</button>
            <div id="historyList" style="margin-top:12px; max-height:300px; overflow-y:auto;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“ˆ</i> èµ°åŠ¿æŠ˜çº¿å›¾ <span class="feature-badge">æœ€è¿‘30æœŸ</span></div>
            <div class="canvas-container">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”¥</i> é—æ¼çƒ­åŠ›å›¾ <span class="feature-badge">å†·å·â‰¥15æœŸé«˜äº®</span></div>
            <div id="heatmap"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ¯</i> ä¸‰èƒ†æ¨è</div>
            <div class="grid5" id="best3"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸš«</i> æ™ºèƒ½æ€å·</div>
            <div class="grid5" id="killNums"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§§</i> ç²¾é€‰5ç»„</div>
            <button class="btn btn-primary" onclick="checkVipAndRun(gen5Group)">ç”Ÿæˆ</button>
            <div id="group5" style="margin-top:16px;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§ </i> AIé¢„æµ‹ <span class="feature-badge">è‡ªå®šä¹‰æƒé‡</span></div>
            <div class="slider-group">
                <label>é¢‘ç‡æƒé‡</label>
                <input type="range" id="freqWeight" min="0" max="5" step="0.1" value="2.2">
                <span id="freqVal">2.2</span>
            </div>
            <div class="slider-group">
                <label>é—æ¼æƒé‡</label>
                <input type="range" id="missWeight" min="0" max="2" step="0.1" value="0.3">
                <span id="missVal">0.3</span>
            </div>
            <div class="slider-group">
                <label>é‚»å·/é‡å·</label>
                <input type="range" id="nearWeight" min="0" max="3" step="0.1" value="1.5">
                <span id="nearVal">1.5</span>
            </div>
            <button class="btn btn-primary" onclick="genPredictWithWeights()">å¼€å§‹é¢„æµ‹</button>
            <div class="loading" id="loading">è®¡ç®—ä¸­...</div>
            <div class="balls" id="resultBalls"></div>
            <div class="rate" id="rate"></div>
            <button class="btn btn-outline" style="width:100%" onclick="copyResult()">å¤åˆ¶</button>
            <div class="explain-box" id="explainBox">ç‚¹å‡»é¢„æµ‹æŸ¥çœ‹å·ç è¯„åˆ†æ„æˆ</div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ”®</i> å¤šæœŸé¢„æµ‹ <span class="feature-badge">æœªæ¥3æœŸ</span></div>
            <button class="btn btn-primary" onclick="genMultiPeriod()">ç”Ÿæˆ</button>
            <div id="multiPeriod" style="margin-top:16px;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ§®</i> å¥–é‡‘è®¡ç®—å™¨</div>
            <input type="number" id="betMoney" placeholder="æŠ•æ³¨é‡‘é¢(å…ƒ)" value="2">
            <input type="number" id="multiplier" placeholder="å€æ•°" value="1">
            <button class="btn btn-primary" onclick="calcPrize()">è®¡ç®—</button>
            <div class="summary-row" id="prizeResult">é¢„è®¡å¥–é‡‘ï¼š0å…ƒ</div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>ğŸ“¸</i> åˆ†äº«é¢„æµ‹å›¾ç‰‡</div>
            <button class="btn btn-primary share-btn" onclick="sharePrediction()">ç”Ÿæˆåˆ†äº«å›¾</button>
            <div id="shareArea" style="margin-top:16px; text-align:center;"></div>
        </div>
        <div class="card" data-module="pl5">
            <div class="card-title"><i>âš™ï¸</i> é«˜çº§ç®—æ³•å®éªŒå®¤</div>
            <div class="algo-grid">
                <div class="algo-card" onclick="runHotAlgo()">
                    <div class="algo-title">ğŸ”¥ å†·çƒ­ç®—æ³•</div>
                    <div class="algo-balls" id="hotAlgoBalls"></div>
                </div>
                <div class="algo-card" onclick="runMissAlgo()">
                    <div class="algo-title">â³ é—æ¼ç®—æ³•</div>
                    <div class="algo-balls" id="missAlgoBalls"></div>
                </div>
                <div class="algo-card" onclick="runPatternAlgo()">
                    <div class="algo-title">ğŸ“ å½¢æ€ç®—æ³•</div>
                    <div class="algo-balls" id="patternAlgoBalls"></div>
                </div>
                <div class="algo-card" onclick="runComprehensiveAlgo()">
                    <div class="algo-title">ğŸ§¬ ç»¼åˆç®—æ³•</div>
                    <div class="algo-balls" id="compAlgoBalls"></div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="runAllAlgos()">ä¸€é”®è¿è¡Œ</button>
            <button class="btn btn-outline" onclick="copyAllAlgos()">å¤åˆ¶ç»“æœ</button>
        </div>

        <!-- æ’åˆ—ä¸‰ (ä¿æŒä¸å˜) -->
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> 6ç æ¨è</div>
            <button class="btn btn-primary" onclick="checkVipAndRun(genP3SixCode)">ç”Ÿæˆ6ç </button>
            <div class="p3-box" id="p3SixBalls"></div>
            <button class="btn btn-outline" onclick="copyP3Result()">å¤åˆ¶</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> 7ç æ¨è</div>
            <button class="btn btn-primary" onclick="checkVipAndRun(genP3SevenCode)">ç”Ÿæˆ7ç </button>
            <div class="p3-box" id="p3SevenBalls"></div>
            <button class="btn btn-outline" onclick="copyP3SevenResult()">å¤åˆ¶</button>
        </div>
        <div class="card" data-module="p3">
            <div class="card-title"><i>ğŸ¯</i> 20æ³¨ç²¾é€‰</div>
            <button class="btn btn-primary" onclick="checkVipAndRun(genP3Twenty)">ç”Ÿæˆ</button>
            <div class="p3-list" id="p3TwentyList"></div>
            <button class="btn btn-outline" onclick="copyP3Twenty()">å¤åˆ¶å…¨éƒ¨</button>
        </div>

        <!-- å¤§ä¹é€ (åŸºäº500æœŸæ•°æ®) -->
        <div class="card" data-module="lotto">
            <div class="card-title"><i>ğŸ°</i> å¤§ä¹é€æ¨è <span class="feature-badge">500æœŸå†å²</span></div>
            <button class="btn btn-primary" onclick="genLotto()">ç”Ÿæˆ</button>
            <div style="text-align:center;">å‰åŒº</div>
            <div class="lotto-box" id="lottoFront"></div>
            <div style="text-align:center;">ååŒº</div>
            <div class="lotto-box" id="lottoBack"></div>
            <button class="btn btn-outline" onclick="copyLotto()">å¤åˆ¶</button>
        </div>

        <!-- åŒè‰²çƒ (åŸºäº500æœŸæ•°æ®) -->
        <div class="card" data-module="ssq">
            <div class="card-title"><i>ğŸ”´</i> åŒè‰²çƒæ¨è <span class="feature-badge">500æœŸå†å²</span></div>
            <button class="btn btn-primary" onclick="genSSQ()">ç”Ÿæˆ</button>
            <div style="text-align:center;">çº¢çƒ</div>
            <div class="ssq-box" id="ssqRed"></div>
            <div style="text-align:center;">è“çƒ</div>
            <div class="ssq-box" id="ssqBlue"></div>
            <button class="btn btn-outline" onclick="copySSQ()">å¤åˆ¶</button>
        </div>

        <!-- ä»Šæ—¥æ±‡æ€» -->
        <div class="card summary-card" data-module="summary">
            <div class="card-title">ğŸ“‹ ä»Šæ—¥AIæ¨èæ±‡æ€»</div>
            <div style="line-height:2;">
                <p><strong>æ’åˆ—äº”ï¼š</strong><span id="t_pl5"></span></p>
                <p><strong>æ’åˆ—ä¸‰ï¼š</strong><span id="t_p3"></span></p>
                <p><strong>å¤§ä¹é€ï¼š</strong><span id="t_lotto"></span></p>
                <p><strong>åŒè‰²çƒï¼š</strong><span id="t_ssq"></span></p>
            </div>
            <button class="btn btn-primary" onclick="genTodayAll()">åˆ·æ–°</button>
            <button class="btn btn-outline" onclick="copyTodayAll()">å¤åˆ¶æ±‡æ€»</button>
        </div>

        <!-- ç®¡ç†åå° -->
        <div class="card admin-box" id="adminBox">
            <div class="card-title">ğŸ”‘ ç®¡ç†åå°</div>
            <input type="password" id="adminPwd" placeholder="ç®¡ç†å¯†ç ">
            <button class="btn btn-primary" onclick="checkAdmin()">ç™»å½•</button>
            <div id="adminPanel">
                <div class="card-title">æ•°æ®ç®¡ç†</div>
                <input placeholder="æœŸå·" id="addIssue">
                <input placeholder="å·ç " id="addNumber">
                <button class="btn btn-primary" onclick="addManualIssue()">æ·»åŠ </button>
                <div class="card-title" style="margin-top:20px">å¯†ç è®¾ç½®</div>
                <input placeholder="è®¿é—®å¯†ç " id="newVisitPwd">
                <input placeholder="ç®¡ç†å¯†ç " id="newAdminPwd">
                <button class="btn btn-outline" onclick="changePwd()">ä¿å­˜</button>
            </div>
        </div>

        <div class="copyright">AIé¢„æµ‹ç³»ç»Ÿ Â© å¢å¼ºç‰ˆ 500æœŸå¤§æ•°æ®</div>
    </div>
</div>

<script>
// å…¨å±€å˜é‡
document.oncontextmenu = () => false;
document.onkeydown = e => {
    if(e.key === "F12") return false;
    if(e.ctrlKey && e.shiftKey && e.key === "I") return false;
    if(e.ctrlKey && e.key === "u") return false;
};

// åˆ‡æ¢æ ‡ç­¾
function switchTab(tab) {
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    document.querySelector(`.nav-item[data-tab="${tab}"]`).classList.add('active');
    document.querySelectorAll('.card').forEach(c => c.classList.remove('show'));
    if(tab === 'home') document.querySelector('[data-module="home"]').classList.add('show');
    if(tab === 'pl5') document.querySelectorAll('[data-module="pl5"]').forEach(c => c.classList.add('show'));
    if(tab === 'p3') document.querySelectorAll('[data-module="p3"]').forEach(c => c.classList.add('show'));
    if(tab === 'lotto') document.querySelectorAll('[data-module="lotto"]').forEach(c => c.classList.add('show'));
    if(tab === 'ssq') document.querySelectorAll('[data-module="ssq"]').forEach(c => c.classList.add('show'));
    if(tab === 'summary') document.querySelector('[data-module="summary"]').classList.add('show');
    if(tab === 'pl5') { updateHeatmap(); drawTrendChart(); }
}
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => { switchTab(item.dataset.tab); });
});

// å¸¸é‡
const DEFAULT_VISIT_PWD = "888888";
const DEFAULT_ADMIN_PWD = "123456";
const STORAGE_KEY = "ALL_DATA_FINAL_V2";
const LOTTO_STORAGE_KEY = "LOTTO_DATA_V2";
const SSQ_STORAGE_KEY = "SSQ_DATA_V2";
const PWD_STORE = "PWD_CFG";

let DATA = [];          // æ’åˆ—äº”500æœŸ
let LOTTO_DATA = [];
let SSQ_DATA = [];
let visitPwd = DEFAULT_VISIT_PWD;
let adminPwd = DEFAULT_ADMIN_PWD;

// æƒé‡å˜é‡
let freqWeight = 2.2, missWeight = 0.3, nearWeight = 1.5;

// åˆå§‹åŒ–
function loadAllConfig(){
    try{
        const p=JSON.parse(localStorage.getItem(PWD_STORE));
        if(p){ visitPwd = p.visit || visitPwd; adminPwd = p.admin || adminPwd; }
    }catch(e){}
}

// ç”Ÿæˆ500æœŸæ’åˆ—äº” (æ¨¡æ‹ŸçœŸå®)
function getDefaultData() {
    const data = [];
    const startDate = new Date('2024-01-01');
    const phases = [
        { hot: [1,3,5,7], cold: [0,2,4,6,8,9] },
        { hot: [2,4,6,8], cold: [0,1,3,5,7,9] },
        { hot: [0,2,4,6,8], cold: [1,3,5,7,9] },
        { hot: [1,3,5,7,9], cold: [0,2,4,6,8] },
        { hot: [0,5,6], cold: [1,2,3,4,7,8,9] }
    ];
    for (let i = 1; i <= 500; i++) {
        const issue = `26${i.toString().padStart(3, '0')}`;
        const nums = [];
        const phase = Math.floor((i-1) / 100) % 2; // æ¯100æœŸè½®æ¢
        for (let j = 0; j < 5; j++) {
            let num;
            if (phase === 0) {
                if (Math.random() < 0.7) {
                    num = phases[j].hot[Math.floor(Math.random() * phases[j].hot.length)];
                } else {
                    num = Math.floor(Math.random() * 10);
                }
            } else {
                if (Math.random() < 0.4) {
                    num = phases[j].cold[Math.floor(Math.random() * phases[j].cold.length)];
                } else {
                    num = Math.floor(Math.random() * 10);
                }
            }
            nums.push(num);
        }
        if (i % 37 === 0) {
            for (let j=0; j<5; j++) nums[j] = (j + (i%10)) % 10; // é¡ºå­
        }
        if (i > 1 && i % 10 === 0 && data.length>0) {
            const prev = data[data.length-1].number.split(' ').map(Number);
            for (let j=0; j<5; j++) {
                if (Math.random() < 0.6) nums[j] = prev[j];
            }
        }
        const numberStr = nums.join(' ');
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i - 1);
        const dateStr = currentDate.toISOString().split('T')[0];
        data.push({ issueno: issue, number: numberStr, date: dateStr });
    }
    // ç‰¹æ®Šæ ‡æ³¨
    data[20] = { issueno: "26021", number: "1 2 3 4 5", date: "2024-01-21" };
    data[100] = { issueno: "26101", number: "6 6 6 6 6", date: "2024-04-10" };
    data[250] = { issueno: "26251", number: "0 0 0 0 0", date: "2024-09-07" };
    return data.sort((a, b) => parseInt(b.issueno) - parseInt(a.issueno));
}

// å¤§ä¹é€500æœŸ
function getDefaultLottoData() {
    const data = [];
    const startDate = new Date('2024-01-01');
    for (let i = 1; i <= 500; i++) {
        const issue = `26${i.toString().padStart(3, '0')}`;
        let front = [];
        while (front.length < 5) {
            let n = Math.floor(Math.random() * 35) + 1;
            if (!front.includes(n)) front.push(n);
        }
        front.sort((a,b)=>a-b);
        let back = [];
        while (back.length < 2) {
            let n = Math.floor(Math.random() * 12) + 1;
            if (!back.includes(n)) back.push(n);
        }
        back.sort((a,b)=>a-b);
        if (i % 30 === 0) { front = [5,12,18,23,30]; back = [3,8]; }
        if (i % 45 === 0) { front = [7,8,9,10,11]; back = [1,12]; }
        const numberStr = front.join(' ') + ' + ' + back.join(' ');
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i - 1);
        const dateStr = currentDate.toISOString().split('T')[0];
        data.push({ issueno: issue, front, back, number: numberStr, date: dateStr });
    }
    return data.sort((a, b) => parseInt(b.issueno) - parseInt(a.issueno));
}

// åŒè‰²çƒ500æœŸ
function getDefaultSSQData() {
    const data = [];
    const startDate = new Date('2024-01-01');
    for (let i = 1; i <= 500; i++) {
        const issue = `26${i.toString().padStart(3, '0')}`;
        let red = [];
        while (red.length < 6) {
            let n = Math.floor(Math.random() * 33) + 1;
            if (!red.includes(n)) red.push(n);
        }
        red.sort((a,b)=>a-b);
        let blue = [Math.floor(Math.random() * 16) + 1];
        if (i % 20 === 0) { red = [3,6,9,12,15,18]; blue = [7]; }
        if (i % 33 === 0) { red = [10,11,12,13,14,15]; blue = [16]; }
        const numberStr = red.join(' ') + ' + ' + blue[0];
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i - 1);
        const dateStr = currentDate.toISOString().split('T')[0];
        data.push({ issueno: issue, red, blue, number: numberStr, date: dateStr });
    }
    return data.sort((a, b) => parseInt(b.issueno) - parseInt(a.issueno));
}

function loadFromStorage(){
    try{
        const s=localStorage.getItem(STORAGE_KEY);
        DATA=s?JSON.parse(s):getDefaultData();
        const l=localStorage.getItem(LOTTO_STORAGE_KEY);
        LOTTO_DATA=l?JSON.parse(l):getDefaultLottoData();
        const q=localStorage.getItem(SSQ_STORAGE_KEY);
        SSQ_DATA=q?JSON.parse(q):getDefaultSSQData();
    }catch(e){
        DATA=getDefaultData();
        LOTTO_DATA=getDefaultLottoData();
        SSQ_DATA=getDefaultSSQData();
    }
}

// è¾…åŠ©å‡½æ•°
function allNumbers(){ return DATA.map(d=>d.number.split(" ").map(Number)); }
function pos(p){ return allNumbers().map(n=>n[p]); }

// æ›´æ–°æ»‘å—æ˜¾ç¤º
document.getElementById('freqWeight').addEventListener('input', e => {
    freqWeight = parseFloat(e.target.value);
    document.getElementById('freqVal').innerText = freqWeight.toFixed(1);
});
document.getElementById('missWeight').addEventListener('input', e => {
    missWeight = parseFloat(e.target.value);
    document.getElementById('missVal').innerText = missWeight.toFixed(1);
});
document.getElementById('nearWeight').addEventListener('input', e => {
    nearWeight = parseFloat(e.target.value);
    document.getElementById('nearVal').innerText = nearWeight.toFixed(1);
});

// è¯„åˆ†å‡½æ•°ï¼ˆä½¿ç”¨æƒé‡ï¼‰
function computeScoresWithWeights(p) {
    const arr = pos(p);
    const total = arr.length;
    const freqWeighted = {};
    for (let n=0; n<10; n++) freqWeighted[n] = 0;
    for (let i=0; i<total; i++) {
        const num = arr[i];
        const weight = Math.exp(-i / 15); // è¡°å‡
        freqWeighted[num] += weight;
    }
    const miss = {};
    for (let n=0; n<10; n++) {
        let m = 0;
        for (let i=0; i<total; i++) {
            if (arr[i] === n) break;
            m++;
        }
        miss[n] = m;
    }
    const recent5 = arr.slice(0,5).filter(x => x !== undefined);
    const lastNum = arr[0];

    const scores = {};
    for (let n=0; n<10; n++) {
        let score = freqWeighted[n] * freqWeight;
        score += miss[n] * missWeight;
        if (n === lastNum) score += nearWeight * 1.3;
        if (lastNum !== undefined && Math.abs(n - lastNum) === 1) score += nearWeight;
        if (recent5.includes(n)) score += nearWeight * 0.5;
        score += Math.random() * 0.3;
        scores[n] = score;
    }
    return scores;
}

// å¸¦è§£é‡Šçš„é¢„æµ‹
function genPredictWithWeights() {
    const el = document.getElementById("resultBalls");
    const load = document.getElementById("loading");
    el.innerHTML = ""; load.style.display = "block";
    setTimeout(() => {
        let r = [];
        let explain = "";
        for (let p=0; p<5; p++) {
            const scores = computeScoresWithWeights(p);
            const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
            r.push(+sorted[0][0]);
            explain += `ç¬¬${p+1}ä½: æ¨è${sorted[0][0]}  (é¢‘ç‡åˆ†:${scores[sorted[0][0]].toFixed(1)} æ¬¡é«˜:${sorted[1]?.[0]}:${sorted[1]?.[1].toFixed(1)})<br>`;
        }
        el.innerHTML = r.map(n => `<div class="ball">${n}</div>`).join('');
        load.style.display = "none";
        document.getElementById("rate").innerText = "ä¿¡å¿ƒæŒ‡æ•°ï¼š" + (85 + Math.floor(Math.random()*10)) + "%";
        window.lastResult = r.join(" ");
        document.getElementById("explainBox").innerHTML = explain;
    }, 300);
}

// å¤šæœŸé¢„æµ‹
function genMultiPeriod() {
    let html = '';
    for (let period=1; period<=3; period++) {
        let nums = [];
        for (let p=0; p<5; p++) {
            const scores = computeScoresWithWeights(p);
            const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
            nums.push(sorted[0][0]);
        }
        html += `<div class="history-item"><span>ç¬¬${period}æœŸ</span><span>${nums.join(' ')}</span></div>`;
    }
    document.getElementById('multiPeriod').innerHTML = html;
}

// å¥–é‡‘è®¡ç®—å™¨ (ç›´é€‰)
function calcPrize() {
    const money = parseFloat(document.getElementById('betMoney').value) || 2;
    const multi = parseFloat(document.getElementById('multiplier').value) || 1;
    const prize = 100000 * multi * (money/2); // å‡è®¾ç›´é€‰å¥–é‡‘10ä¸‡
    document.getElementById('prizeResult').innerText = `é¢„è®¡å¥–é‡‘ï¼š${prize.toFixed(2)}å…ƒ (ç†è®ºæœ€é«˜)`;
}

// åˆ†äº«å›¾ç‰‡
function sharePrediction() {
    const node = document.getElementById('resultBalls').cloneNode(true);
    if (!node.children.length) { alert('è¯·å…ˆé¢„æµ‹'); return; }
    const div = document.createElement('div');
    div.style.background = '#1a1a1a';
    div.style.padding = '20px';
    div.style.borderRadius = '16px';
    div.style.display = 'inline-block';
    div.appendChild(node);
    document.getElementById('shareArea').innerHTML = '';
    document.getElementById('shareArea').appendChild(div);
    html2canvas(div).then(canvas => {
        const img = document.createElement('a');
        img.href = canvas.toDataURL('image/png');
        img.download = 'é¢„æµ‹åˆ†äº«.png';
        img.click();
    });
}

// èµ°åŠ¿å›¾
function drawTrendChart() {
    const ctx = document.getElementById('trendChart')?.getContext('2d');
    if (!ctx) return;
    const recent = DATA.slice(0,30).reverse(); // ä»æ—§åˆ°æ–°
    const labels = recent.map(d => d.issueno);
    const datasets = [];
    for (let pos=0; pos<5; pos++) {
        datasets.push({
            label: `ç¬¬${pos+1}ä½`,
            data: recent.map(d => parseInt(d.number.split(' ')[pos])),
            borderColor: ['#c9a868','#00aaff','#ff4d4f','#1677ff','#cf1322'][pos],
            tension: 0.2,
            pointRadius: 2
        });
    }
    new Chart(ctx, {
        type: 'line',
        data: { labels, datasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { min: 0, max: 9, stepSize: 1 } },
            plugins: { legend: { labels: { color: '#fff' } } }
        }
    });
}

// çƒ­åŠ›å›¾
function updateHeatmap() {
    const miss = getMissArray();
    let html = '<div class="heatmap-grid">';
    for (let p=0; p<5; p++) {
        for (let n=0; n<10; n++) {
            let val = miss[p][n];
            let cls = val >= 15 ? 'hot' : (val >= 10 ? '' : 'cold');
            html += `<div class="heat-cell ${cls}" title="ä½${p+1} å·${n} é—æ¼${val}">${n}<br><small>${val}</small></div>`;
        }
    }
    html += '</div>';
    document.getElementById('heatmap').innerHTML = html;
}

function getMissArray() {
    const miss = [];
    for (let p = 0; p < 5; p++) {
        const arr = pos(p);
        const m = {};
        for (let n = 0; n < 10; n++) {
            let cnt = 0;
            for (let i = 0; i < arr.length; i++) {
                if (arr[i] === n) break;
                cnt++;
            }
            m[n] = cnt;
        }
        miss.push(m);
    }
    return miss;
}

// åŸæœ‰å‡½æ•°ä¿ç•™ (best3, killNumbers, gen5Group, getTopSuperç­‰éœ€å¼•ç”¨æ–°è¯„åˆ†)
function getTopSuper(p, cnt=3) {
    const scores = computeScoresWithWeights(p);
    return Object.entries(scores).sort((a,b)=>b[1]-a[1]).map(x=>+x[0]).slice(0,cnt);
}
function best3(){
    let h="";
    for(let p=0;p<5;p++){
        const t=getTopSuper(p,3);
        h+=`<div class="item">ç¬¬${p+1}ä½<br><strong>${t[0]} ${t[1]} ${t[2]}</strong></div>`;
    }
    document.getElementById("best3").innerHTML=h;
}
function killNumbers(){
    const all=allNumbers().flat();
    const cnt={};
    all.forEach(n=>cnt[n]=(cnt[n]||0)+1);
    const kill=Object.entries(cnt).sort((a,b)=>a[1]-b[1]).slice(0,5).map(x=>x[0]);
    document.getElementById("killNums").innerHTML=kill.map(n=>`<div class="item">${n}</div>`).join("");
}
function gen5Group(){
    let res=[];
    while(res.length<5){
        let line=[];
        for(let p=0;p<5;p++){
            const pool=getTopSuper(p,4);
            line.push(pool[Math.floor(Math.random()*pool.length)]);
        }
        res.push(line.join(" "));
    }
    document.getElementById("group5").innerHTML=res.map(s=>`<div class="history-item">${s}</div>`).join("");
}
function getP3SuperTotal(){
    const total={};
    for(let n=0;n<10;n++) total[n]=0;
    const flat=allNumbers().flat();
    flat.forEach((num,i)=>{ const w=Math.exp(-i/4); total[num]+=w; });
    return Object.entries(total).sort((a,b)=>b[1]-a[1]).map(x=>+x[0]);
}
function genP3SixCode(){
    const six=getP3SuperTotal().slice(0,6);
    document.getElementById("p3SixBalls").innerHTML=six.map(n=>`<div class="p3-ball">${n}</div>`).join('');
    window.lastP3Result=six.join(" ");
}
function copyP3Result(){ if(window.lastP3Result) navigator.clipboard.writeText(window.lastP3Result); }
function genP3SevenCode(){
    const seven=getP3SuperTotal().slice(0,7);
    document.getElementById("p3SevenBalls").innerHTML=seven.map(n=>`<div class="p3-ball">${n}</div>`).join('');
    window.lastP3SevenResult=seven.join(" ");
}
function copyP3SevenResult(){ if(window.lastP3SevenResult) navigator.clipboard.writeText(window.lastP3SevenResult); }
function genP3Twenty(){
    const list=[];
    const top=getP3SuperTotal();
    while(list.length<20){
        const a=top[Math.floor(Math.random()*6)];
        const b=top[Math.floor(Math.random()*6)];
        const c=top[Math.floor(Math.random()*6)];
        const num=[a,b,c].join(" ");
        if(!list.includes(num)) list.push(num);
    }
    document.getElementById("p3TwentyList").innerHTML=list.map((item,i)=>`
        <div class="p3-item"><span>ç¬¬${i+1}æ³¨</span><span>${item}</span></div>
    `).join("");
    window.p3TwentyData=list.join("\n");
}
function copyP3Twenty(){ if(window.p3TwentyData) navigator.clipboard.writeText(window.p3TwentyData); }

// å¤§ä¹é€æ™ºèƒ½ç”Ÿæˆ
function genLotto() {
    const scores = computeLottoScores();
    let frontCandidates = Object.entries(scores.front).map(([n,s])=>({num:parseInt(n),score:s})).sort((a,b)=>b.score-a.score).slice(0,8).map(x=>x.num);
    let selectedFront = [];
    while(selectedFront.length<5){
        let n = frontCandidates[Math.floor(Math.random()*frontCandidates.length)];
        if(!selectedFront.includes(n)) selectedFront.push(n);
    }
    selectedFront.sort((a,b)=>a-b);
    let backCandidates = Object.entries(scores.back).map(([n,s])=>({num:parseInt(n),score:s})).sort((a,b)=>b.score-a.score).slice(0,5).map(x=>x.num);
    let selectedBack = [];
    while(selectedBack.length<2){
        let n = backCandidates[Math.floor(Math.random()*backCandidates.length)];
        if(!selectedBack.includes(n)) selectedBack.push(n);
    }
    selectedBack.sort((a,b)=>a-b);
    lottoFrontCache = selectedFront;
    lottoBackCache = selectedBack;
    document.getElementById("lottoFront").innerHTML = selectedFront.map(n=>`<div class="lotto-front">${n}</div>`).join("");
    document.getElementById("lottoBack").innerHTML = selectedBack.map(n=>`<div class="lotto-back">${n}</div>`).join("");
}
function copyLotto(){ navigator.clipboard.writeText(lottoFrontCache.join(" ")+" + "+lottoBackCache.join(" ")); }

function computeLottoScores() {
    const frontScores = {}, backScores = {};
    for(let i=1;i<=35;i++) frontScores[i]=0;
    for(let i=1;i<=12;i++) backScores[i]=0;
    LOTTO_DATA.forEach((item,idx)=>{
        const w = Math.exp(-idx/20);
        item.front.forEach(n=>frontScores[n]+=w);
        item.back.forEach(n=>backScores[n]+=w);
    });
    return {front:frontScores, back:backScores};
}

// åŒè‰²çƒæ™ºèƒ½ç”Ÿæˆ
function genSSQ() {
    const scores = computeSSQScores();
    let redCandidates = Object.entries(scores.red).map(([n,s])=>({num:parseInt(n),score:s})).sort((a,b)=>b.score-a.score).slice(0,12).map(x=>x.num);
    let selectedRed = [];
    while(selectedRed.length<6){
        let n = redCandidates[Math.floor(Math.random()*redCandidates.length)];
        if(!selectedRed.includes(n)) selectedRed.push(n);
    }
    selectedRed.sort((a,b)=>a-b);
    let blueCandidates = Object.entries(scores.blue).map(([n,s])=>({num:parseInt(n),score:s})).sort((a,b)=>b.score-a.score).slice(0,5).map(x=>x.num);
    let selectedBlue = [blueCandidates[Math.floor(Math.random()*blueCandidates.length)]];
    ssqRedCache = selectedRed;
    ssqBlueCache = selectedBlue;
    document.getElementById("ssqRed").innerHTML = selectedRed.map(n=>`<div class="ssq-red">${n}</div>`).join("");
    document.getElementById("ssqBlue").innerHTML = selectedBlue.map(n=>`<div class="ssq-blue">${n}</div>`).join("");
}
function copySSQ(){ navigator.clipboard.writeText("çº¢çƒï¼š"+ssqRedCache.join(" ")+" è“çƒï¼š"+ssqBlueCache[0]); }

function computeSSQScores() {
    const redScores={}, blueScores={};
    for(let i=1;i<=33;i++) redScores[i]=0;
    for(let i=1;i<=16;i++) blueScores[i]=0;
    SSQ_DATA.forEach((item,idx)=>{
        const w = Math.exp(-idx/20);
        item.red.forEach(n=>redScores[n]+=w);
        item.blue.forEach(n=>blueScores[n]+=w);
    });
    return {red:redScores, blue:blueScores};
}

// é«˜çº§ç®—æ³•å®éªŒå®¤ (ç®€åŒ–)
function runHotAlgo() {
    let r=[];
    for(let p=0;p<5;p++){
        let top = getTopSuper(p,3);
        r.push(top[Math.floor(Math.random()*top.length)]);
    }
    document.getElementById('hotAlgoBalls').innerHTML = r.map(n=>`<div class="algo-ball">${n}</div>`).join('');
    window.hotAlgoResult = r.join(' ');
}
function runMissAlgo() {
    let miss = getMissArray();
    let r=[];
    for(let p=0;p<5;p++){
        let top = Object.entries(miss[p]).sort((a,b)=>b[1]-a[1]).slice(0,3).map(x=>+x[0]);
        r.push(top[Math.floor(Math.random()*top.length)]);
    }
    document.getElementById('missAlgoBalls').innerHTML = r.map(n=>`<div class="algo-ball">${n}</div>`).join('');
    window.missAlgoResult = r.join(' ');
}
function runPatternAlgo() {
    let r=[];
    for(let p=0;p<5;p++){
        let arr = pos(p).slice(0,15);
        let odd = arr.filter(x=>x%2).length;
        let big = arr.filter(x=>x>=5).length;
        let candidates = [];
        for(let n=0;n<10;n++){
            let score=0;
            if(odd<7 && n%2) score+=2;
            if(odd>7 && n%2===0) score+=2;
            if(big<7 && n>=5) score+=2;
            if(big>7 && n<5) score+=2;
            candidates.push({n,score});
        }
        candidates.sort((a,b)=>b.score-a.score);
        r.push(candidates[0].n);
    }
    document.getElementById('patternAlgoBalls').innerHTML = r.map(n=>`<div class="algo-ball">${n}</div>`).join('');
    window.patternAlgoResult = r.join(' ');
}
function runComprehensiveAlgo() {
    let r=[];
    for(let p=0;p<5;p++){
        let scores = computeScoresWithWeights(p);
        r.push(+Object.entries(scores).sort((a,b)=>b[1]-a[1])[0][0]);
    }
    document.getElementById('compAlgoBalls').innerHTML = r.map(n=>`<div class="algo-ball">${n}</div>`).join('');
    window.compAlgoResult = r.join(' ');
}
function runAllAlgos(){ runHotAlgo(); runMissAlgo(); runPatternAlgo(); runComprehensiveAlgo(); }
function copyAllAlgos(){ navigator.clipboard.writeText(`å†·çƒ­:${window.hotAlgoResult}\né—æ¼:${window.missAlgoResult}\nå½¢æ€:${window.patternAlgoResult}\nç»¼åˆ:${window.compAlgoResult}`); }

// å†å²åŠ è½½ç­‰
function loadHistory(){
    const v = document.getElementById("issueInput").value.trim();
    const el = document.getElementById("historyList");
    if(!v){
        el.innerHTML = DATA.slice(0,15).map(d=>`<div class="history-item"><span>${d.issueno}</span><span>${d.number}</span><span>${d.date}</span></div>`).join("");
        return;
    }
    const f = DATA.find(x=>x.issueno==v);
    el.innerHTML = f ? `<div class="history-item"><span>${f.issueno}</span><span>${f.number}</span><span>${f.date}</span></div>` : "<p class='tip'>æ— æ•°æ®</p>";
}
function totalStat(){
    const all=allNumbers().flat();
    const cnt={};
    for(let n=0;n<10;n++) cnt[n]=0;
    all.forEach(n=>cnt[n]++);
    document.getElementById("statTotal").innerHTML=Object.entries(cnt).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<span>${k}:${v}æ¬¡</span>`).join('');
}
function fullRefresh(){ totalStat(); loadHistory(); updateHeatmap(); best3(); killNumbers(); }

// ç™»å½•ç›¸å…³
function closeAd(){ document.getElementById("adLock").style.display = "none"; document.getElementById("loginLock").style.display = "flex"; }
function checkVisit(){
    const v=document.getElementById("visitPwd").value.trim();
    if(v===visitPwd){ document.getElementById("loginLock").style.display = "none"; document.getElementById("mainContainer").style.display = "block"; initSystem(); }
    else alert("å¯†ç é”™è¯¯");
}
function checkVipAndRun(fn){ fn(); }
function closeVipModal(){}

// å€’è®¡æ—¶
function runCountdown(){
    const cd=document.getElementById("countdown");
    setInterval(()=>{
        const now=new Date(); const next=new Date(); next.setHours(21,0,0,0);
        if(now>next) next.setDate(next.getDate()+1);
        const d=next-now; const h=Math.floor(d/3600000); const m=Math.floor((d%3600000)/60000); const s=Math.floor((d%60000)/1000);
        cd.textContent=`å€’è®¡æ—¶ï¼š${h}æ—¶ ${m}åˆ† ${s}ç§’`;
    },1000);
}

// ç®¡ç†
document.getElementById("adminBtn").onclick = () => {
    const box=document.getElementById("adminBox");
    box.style.display=box.style.display==="block"?"none":"block";
};
function checkAdmin(){
    const p=document.getElementById("adminPwd").value.trim();
    if(p===adminPwd){ document.getElementById("adminPanel").style.display="block"; alert("ç™»å½•æˆåŠŸ"); }
    else alert("å¯†ç é”™è¯¯");
}
function addManualIssue(){
    const issue=document.getElementById("addIssue").value.trim();
    const num=document.getElementById("addNumber").value.trim();
    if(!issue || !num) return;
    DATA.unshift({issueno:issue,number:num,date:new Date().toISOString().split("T")[0]});
    localStorage.setItem(STORAGE_KEY,JSON.stringify(DATA));
    fullRefresh();
}
function changePwd(){
    const v=document.getElementById("newVisitPwd").value.trim();
    const a=document.getElementById("newAdminPwd").value.trim();
    if(v) visitPwd=v; if(a) adminPwd=a;
    localStorage.setItem(PWD_STORE,JSON.stringify({visit:visitPwd,admin:adminPwd}));
    alert("ä¿å­˜æˆåŠŸ");
}
document.getElementById("darkBtn").onclick = () => document.body.classList.toggle("dark-mode");

// ä»Šæ—¥æ±‡æ€»
function genTodayAll(){
    let pl5 = []; for(let p=0;p<5;p++){ let s=computeScoresWithWeights(p); pl5.push(+Object.entries(s).sort((a,b)=>b[1]-a[1])[0][0]); }
    let p3 = getP3SuperTotal().slice(0,3).join(' ');
    let lotto = genLotto(); // è§¦å‘æ›´æ–°
    let ssq = genSSQ();
    document.getElementById("t_pl5").innerText = pl5.join(' ');
    document.getElementById("t_p3").innerText = p3;
    document.getElementById("t_lotto").innerText = lottoFrontCache.join(' ')+' + '+lottoBackCache.join(' ');
    document.getElementById("t_ssq").innerText = ssqRedCache.join(' ')+' + '+ssqBlueCache[0];
    todayAll = `ä»Šæ—¥æ¨èï¼š\næ’åˆ—äº”ï¼š${pl5.join(' ')}\næ’åˆ—ä¸‰ï¼š${p3}\nå¤§ä¹é€ï¼š${lottoFrontCache.join(' ')} + ${lottoBackCache.join(' ')}\nåŒè‰²çƒï¼š${ssqRedCache.join(' ')} + ${ssqBlueCache[0]}`;
}
function copyTodayAll(){ if(todayAll) navigator.clipboard.writeText(todayAll).then(()=>alert("å¤åˆ¶æˆåŠŸ")); }

// åˆå§‹åŒ–
function initSystem(){
    loadAllConfig(); loadFromStorage(); fullRefresh(); runCountdown(); switchTab('home');
    setTimeout(()=>{ drawTrendChart(); updateHeatmap(); genLotto(); genSSQ(); runAllAlgos(); }, 300);
}
</script>
</body>
</html>
